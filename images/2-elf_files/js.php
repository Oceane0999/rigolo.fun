var DOKU_BASE='/';var DOKU_TPL='/lib/tpl/tolkiendil/';var DOKU_UHN=1;var DOKU_UHC=1;LANG={"notsavedyet":"Les modifications non enregistr\u00e9es seront perdues.\nVoulez-vous vraiment continuer ?","searchmedia":"Chercher des fichiers","keepopen":"Gardez la fen\u00eatre ouverte pendant la s\u00e9lection","hidedetails":"Masquer d\u00e9tails","mediatitle":"Param\u00e8tres de lien","mediadisplay":"Type de lien","mediaalign":"Alignement","mediasize":"Taille d'image","mediatarget":"Cible du lien","mediaclose":"Fermer","mediainsert":"Ins\u00e9rer","mediadisplayimg":"Afficher l'image.","mediadisplaylnk":"N'afficher que le lien.","mediasmall":"Petite version","mediamedium":"Version moyenne","medialarge":"Grande version","mediaoriginal":"Version originale","medialnk":"Lien vers la page de d\u00e9tail","mediadirect":"Lien direct vers l'original","medianolnk":"Aucun lien","medianolink":"Ne pas lier l'image","medialeft":"Aligner l'image sur la gauche.","mediaright":"Aligner l'image sur la droite.","mediacenter":"Centrer l'image","medianoalign":"Ne pas aligner.","nosmblinks":"Les liens vers les partages Windows ne fonctionnent qu'avec Microsoft Internet Explorer.\nVous pouvez toujours copier puis coller le lien.","linkwiz":"Assistant Lien","linkto":"Lien vers\u00a0:","del_confirm":"Effacer cette entr\u00e9e ?","mu_btn":"Envoyer plusieurs fichiers en m\u00eame temps","plugins":{"gallery":{"addgal":"Add namespace as gallery"}}};var toolbar=[{"type":"format","title":"Emphase forte (gras)","icon":"bold.png","key":"b","open":"**","close":"**","block":false},{"type":"format","title":"Emphase (italique)","icon":"italic.png","key":"i","open":"\/\/","close":"\/\/","block":false},{"type":"format","title":"Soulign\u00e9","icon":"underline.png","key":"u","open":"__","close":"__","block":false},{"type":"format","title":"Code \u00ab\u00a0machine \u00e0 \u00e9crire\u00a0\u00bb","icon":"mono.png","key":"c","open":"''","close":"''","block":false},{"type":"format","title":"Texte barr\u00e9","icon":"strike.png","key":"d","open":"<del>","close":"<\/del>","block":false},{"type":"autohead","title":"Titre de m\u00eame niveau","icon":"hequal.png","key":"8","text":"Titre","mod":0,"block":true},{"type":"autohead","title":"Titre de niveau inf\u00e9rieur","icon":"hminus.png","key":"9","text":"Titre","mod":1,"block":true},{"type":"autohead","title":"Titre de niveau sup\u00e9rieur","icon":"hplus.png","key":"0","text":"Titre","mod":-1,"block":true},{"type":"picker","title":"S\u00e9lectionner la ligne de titre","icon":"h.png","class":"pk_hl","list":[{"type":"format","title":"Titre de niveau 1","icon":"h1.png","key":"1","open":"====== ","close":" ======\\n"},{"type":"format","title":"Titre de niveau 2","icon":"h2.png","key":"2","open":"===== ","close":" =====\\n"},{"type":"format","title":"Titre de niveau 3","icon":"h3.png","key":"3","open":"==== ","close":" ====\\n"},{"type":"format","title":"Titre de niveau 4","icon":"h4.png","key":"4","open":"=== ","close":" ===\\n"},{"type":"format","title":"Titre de niveau 5","icon":"h5.png","key":"5","open":"== ","close":" ==\\n"}],"block":true},{"type":"linkwiz","title":"Lien interne","icon":"link.png","key":"l","open":"[[","close":"]]","block":false},{"type":"format","title":"Lien externe","icon":"linkextern.png","open":"[[","close":"]]","sample":"http:\/\/example.com|Lien externe","block":false},{"type":"formatln","title":"Liste num\u00e9rot\u00e9e","icon":"ol.png","open":"  - ","close":"","key":"-","block":true},{"type":"formatln","title":"Liste \u00e0 puce","icon":"ul.png","open":"  * ","close":"","key":".","block":true},{"type":"insert","title":"Ligne horizontale","icon":"hr.png","insert":"\\n----\\n","block":true},{"type":"mediapopup","title":"Ajouter des images ou d'autres fichiers","icon":"image.png","url":"lib\/exe\/mediamanager.php?ns=","name":"mediaselect","options":"width=750,height=500,left=20,top=20,scrollbars=yes,resizable=yes","block":false},{"type":"picker","title":"\u00c9moticones","icon":"smiley.png","list":{"8-)":"icon_cool.gif","8-O":"icon_eek.gif","8-o":"icon_eek.gif",":-(":"icon_sad.gif",":-)":"icon_smile.gif","=)":"icon_smile2.gif",":-\/":"icon_doubt.gif",":-\\":"icon_doubt2.gif",":-?":"icon_confused.gif",":-D":"icon_biggrin.gif",":-P":"icon_razz.gif",":-o":"icon_surprised.gif",":-O":"icon_surprised.gif",":-x":"icon_silenced.gif",":-X":"icon_silenced.gif",":-|":"icon_neutral.gif",";-)":"icon_wink.gif","^_^":"icon_fun.gif",":?:":"icon_question.gif",":!:":"icon_exclaim.gif","LOL":"icon_lol.gif","FIXME":"fixme.gif","DELETEME":"delete.gif",":*:":"icon_star.gif",":star:":"icon_star.gif",":rblue:":"ring_blue.png",":rred:":"ring_red.png",":rblack:":"ring_black.png",":rwhite:":"ring_white.png",":tinco:":"tinco.gif",":parma:":"parma.gif",":calma:":"calma.gif",":quesse:":"quesse.gif",":ando:":"ando.gif",":umbar:":"umbar.gif",":anga:":"anga.gif",":ungwe:":"ungwe.gif",":sule:":"sule.gif",":formen:":"formen.gif",":aha:":"aha.gif",":hwesta:":"hwesta.gif",":anto:":"anto.gif",":ampa:":"ampa.gif",":anca:":"anca.gif",":unque:":"unque.gif",":numen:":"numen.gif",":malta:":"malta.gif",":noldo:":"noldo.gif",":nwalme:":"nwalme.gif",":ore:":"ore.gif",":vala:":"vala.gif",":anna:":"anna.gif",":vilya:":"vilya.gif",":romen:":"romen.gif",":arda:":"arda.gif",":lambe:":"lambe.gif",":alda:":"alda.gif",":silme:":"silme.gif",":silme_nuquerna:":"silme_nuquerna.gif",":esse:":"esse.gif",":esse_bis:":"esse_bis.gif",":esse_nuquerna:":"esse_nuquerna.gif",":esse_nuquerna_bis:":"esse_nuquerna_bis.gif",":hyarmen:":"hyarmen.gif",":hwesta_sindarinwa:":"hwesta_sindarinwa.gif",":yanta:":"yanta.gif",":ure:":"ure.gif",":halla:":"halla.gif",":vaia:":"vaia.gif",":telco:":"telco.gif",":ara:":"ara.gif",":tengwa0:":"tengwa0.png",":tengwa1:":"tengwa1.png",":tengwa2:":"tengwa2.png",":tengwa3:":"tengwa3.png",":tengwa4:":"tengwa4.png",":tengwa5:":"tengwa5.png",":tengwa6:":"tengwa6.png",":tengwa7:":"tengwa7.png",":tengwa8:":"tengwa8.png",":tengwa9:":"tengwa9.png",":tengwa10:":"tengwa10.png",":tengwa11:":"tengwa11.png",":tengwa12:":"tengwa12.png"},"icobase":"smileys","block":false},{"type":"picker","title":"Caract\u00e8res sp\u00e9ciaux","icon":"chars.png","list":["\u00c0","\u00e0","\u00c1","\u00e1","\u00c2","\u00e2","\u00c3","\u00e3","\u00c4","\u00e4","\u01cd","\u01ce","\u0102","\u0103","\u00c5","\u00e5","\u0100","\u0101","\u0104","\u0105","\u00c6","\u00e6","\u0106","\u0107","\u00c7","\u00e7","\u010c","\u010d","\u0108","\u0109","\u010a","\u010b","\u00d0","\u0111","\u00f0","\u010e","\u010f","\u00c8","\u00e8","\u00c9","\u00e9","\u00ca","\u00ea","\u00cb","\u00eb","\u011a","\u011b","\u0112","\u0113","\u0116","\u0117","\u0118","\u0119","\u0122","\u0123","\u011c","\u011d","\u011e","\u011f","\u0120","\u0121","\u0124","\u0125","\u00cc","\u00ec","\u00cd","\u00ed","\u00ce","\u00ee","\u00cf","\u00ef","\u01cf","\u01d0","\u012a","\u012b","\u0130","\u0131","\u012e","\u012f","\u0134","\u0135","\u0136","\u0137","\u0139","\u013a","\u013b","\u013c","\u013d","\u013e","\u0141","\u0142","\u013f","\u0140","\u0143","\u0144","\u00d1","\u00f1","\u0145","\u0146","\u0147","\u0148","\u00d2","\u00f2","\u00d3","\u00f3","\u00d4","\u00f4","\u00d5","\u00f5","\u00d6","\u00f6","\u01d1","\u01d2","\u014c","\u014d","\u0150","\u0151","\u0152","\u0153","\u00d8","\u00f8","\u0154","\u0155","\u0156","\u0157","\u0158","\u0159","\u015a","\u015b","\u015e","\u015f","\u0160","\u0161","\u015c","\u015d","\u0162","\u0163","\u0164","\u0165","\u00d9","\u00f9","\u00da","\u00fa","\u00db","\u00fb","\u00dc","\u00fc","\u01d3","\u01d4","\u016c","\u016d","\u016a","\u016b","\u016e","\u016f","\u01d6","\u01d8","\u01da","\u01dc","\u0172","\u0173","\u0170","\u0171","\u0174","\u0175","\u00dd","\u00fd","\u0178","\u00ff","\u0176","\u0177","\u0179","\u017a","\u017d","\u017e","\u017b","\u017c","\u00de","\u00fe","\u00df","\u0126","\u0127","\u00bf","\u00a1","\u00a2","\u00a3","\u00a4","\u00a5","\u20ac","\u00a6","\u00a7","\u00aa","\u00ac","\u00af","\u00b0","\u00b1","\u00f7","\u2030","\u00bc","\u00bd","\u00be","\u00b9","\u00b2","\u00b3","\u00b5","\u00b6","\u2020","\u2021","\u00b7","\u2022","\u00ba","\u2200","\u2202","\u2203","\u018f","\u0259","\u2205","\u2207","\u2208","\u2209","\u220b","\u220f","\u2211","\u203e","\u2212","\u2217","\u221a","\u221d","\u221e","\u2220","\u2227","\u2228","\u2229","\u222a","\u222b","\u2234","\u223c","\u2245","\u2248","\u2260","\u2261","\u2264","\u2265","\u2282","\u2283","\u2284","\u2286","\u2287","\u2295","\u2297","\u22a5","\u22c5","\u25ca","\u2118","\u2111","\u211c","\u2135","\u2660","\u2663","\u2665","\u2666","\u03b1","\u03b2","\u0393","\u03b3","\u0394","\u03b4","\u03b5","\u03b6","\u03b7","\u0398","\u03b8","\u03b9","\u03ba","\u039b","\u03bb","\u03bc","\u039e","\u03be","\u03a0","\u03c0","\u03c1","\u03a3","\u03c3","\u03a4","\u03c4","\u03c5","\u03a6","\u03c6","\u03c7","\u03a8","\u03c8","\u03a9","\u03c9","\u2605","\u2606","\u260e","\u261a","\u261b","\u261c","\u261d","\u261e","\u261f","\u2639","\u263a","\u2714","\u2718","\u00d7","\u201e","\u201c","\u201d","\u201a","\u2018","\u2019","\u00ab","\u00bb","\u2039","\u203a","\u2014","\u2013","\u2026","\u2190","\u2191","\u2192","\u2193","\u2194","\u21d0","\u21d1","\u21d2","\u21d3","\u21d4","\u00a9","\u2122","\u00ae","\u2032","\u2033","[","]","{","}","~","(",")","%","\u00a7","$","#","|","@"],"block":false},{"type":"signature","title":"Ins\u00e9rer une signature","icon":"sig.png","key":"y","block":false},{"type":"picker","title":"Format+","icon":"\/lib\/plugins\/formatplus\/images\/formatplus.png","list":[{"type":"format","title":"SmallCaps","icon":"\/lib\/plugins\/formatplus\/images\/caps.png","open":"\/!!","close":"!!\/","block":false},{"type":"format","title":"Sample","icon":"\/lib\/plugins\/formatplus\/images\/samp.png","open":"\/$$","close":"$$\/","block":false},{"type":"format","title":"Variable","icon":"\/lib\/plugins\/formatplus\/images\/var.png","open":"\/??","close":"??\/","block":false},{"type":"format","title":"Keyboard","icon":"\/lib\/plugins\/formatplus\/images\/kbd.png","open":"\/``","close":"``\/","block":false},{"type":"format","title":"Definition","icon":"\/lib\/plugins\/formatplus\/images\/dfn.png","open":"\/@@","close":"@@\/","block":false},{"type":"format","title":"Citation","icon":"\/lib\/plugins\/formatplus\/images\/cite.png","open":"\/&&","close":"&&\/","block":false},{"type":"format","title":"Inverse","icon":"\/lib\/plugins\/formatplus\/images\/inv.png","open":"\/!","close":"!\/","block":false},{"type":"format","title":"Inline Quote","icon":"\/lib\/plugins\/formatplus\/images\/q.png","open":"\/\"\"","close":"\"\"\/","block":false},{"type":"format","title":"Block Quote","icon":"\/lib\/plugins\/formatplus\/images\/quote.png","open":"<quote >","close":"<\/quote>","block":true},{"type":"format","title":"Inserted","icon":"\/lib\/plugins\/formatplus\/images\/ins.png","open":"\/+","close":"+\/","block":false},{"type":"format","title":"Inserted Block","icon":"\/lib\/plugins\/formatplus\/images\/insert.png","open":"<ins >","close":"<\/ins>","block":true},{"type":"format","title":"Deleted","icon":"\/lib\/plugins\/formatplus\/images\/del.png","open":"\/-","close":"-\/","block":false},{"type":"format","title":"Deleted Block","icon":"\/lib\/plugins\/formatplus\/images\/delete.png","open":"<del >","close":"<\/del>","block":true},{"type":"format","title":"Subscript","icon":"\/lib\/plugins\/formatplus\/images\/sub.png","open":"\/,","close":",\/","block":false},{"type":"format","title":"Superscript","icon":"\/lib\/plugins\/formatplus\/images\/super.png","open":"\/^","close":"^\/","block":false}],"block":true}];function isUndefined(prop){return(typeof prop=='undefined');}function isFunction(prop){return(typeof prop=='function');}function isString(prop){return(typeof prop=='string');}function isNumber(prop){return(typeof prop=='number');}function isNumeric(prop){return isNumber(prop)&&!isNaN(prop)&&isFinite(prop);}function isArray(prop){return(prop instanceof Array);}function isRegExp(prop){return(prop instanceof RegExp);}function isBoolean(prop){return('boolean'==typeof prop);}function isScalar(prop){return isNumeric(prop)||isString(prop);}function isEmpty(prop){if(isBoolean(prop))return false;if(isRegExp(prop)&&new RegExp("").toString()==prop.toString())return true;if(isString(prop)||isNumber(prop))return!prop;if(Boolean(prop)&&false!=prop){for(var i in prop)if(prop.hasOwnProperty(i))return false;}return true;}if('undefined'==typeof Object.hasOwnProperty){Object.prototype.hasOwnProperty=function(prop){return!('undefined'==typeof this[prop]||this.constructor&&this.constructor.prototype[prop]&&this[prop]===this.constructor.prototype[prop]);};}function hasFlash(version){var ver=0;try{if(navigator.plugins!=null&&navigator.plugins.length>0){ver=navigator.plugins["Shockwave Flash"].description.split(' ')[2].split('.')[0];}else{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");ver=axo.GetVariable("$version").split(' ')[1].split(',')[0];}}catch(e){}if(ver>=version)return true;return false;}function addEvent(element,type,handler){if(!handler.$$guid)handler.$$guid=addEvent.guid++;if(!element.events)element.events={};var handlers=element.events[type];if(!handlers){handlers=element.events[type]={};if(element["on"+type]){handlers[0]=element["on"+type];}}handlers[handler.$$guid]=handler;element["on"+type]=handleEvent;};addEvent.guid=1;function removeEvent(element,type,handler){if(element.events&&element.events[type]){delete element.events[type][handler.$$guid];}};function handleEvent(event){var returnValue=true;event=event||fixEvent(window.event,this);var handlers=this.events[event.type];for(var i in handlers){if(!handlers.hasOwnProperty(i))continue;if(handlers[i].call(this,event)===false){returnValue=false;}}return returnValue;};function fixEvent(event,_this){event.preventDefault=fixEvent.preventDefault;event.stopPropagation=fixEvent.stopPropagation;event.target=event.srcElement;event.currentTarget=_this;var base=(document.documentElement.scrollTop?document.documentElement:document.body);event.pageX=(typeof event.pageX!=='undefined')?event.pageX:event.clientX+base.scrollLeft;event.pageY=(typeof event.pageY!=='undefined')?event.pageY:event.clientY+base.scrollTop;return event;};fixEvent.preventDefault=function(){this.returnValue=false;};fixEvent.stopPropagation=function(){this.cancelBubble=true;};window.fireoninit=function(){if(arguments.callee.done)return;arguments.callee.done=true;if(_timer){clearInterval(_timer);_timer=null;}if(typeof window.oninit=='function'){window.oninit();}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",window.fireoninit,null);}/*@cc_on @if(@_win32)document.write("<scr"+"ipt id=\"__ie_init\" defer=\"true\" src=\"//:\"><\/script>");var script=document.getElementById("__ie_init");script.onreadystatechange=function(){if(this.readyState=="complete"){window.fireoninit();}};@end @*/if(/WebKit/i.test(navigator.userAgent)){var _timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){window.fireoninit();}},10);}window.onload=window.fireoninit;window.oninit=function(){};function addInitEvent(func){var oldoninit=window.oninit;if(typeof window.oninit!='function'){window.oninit=func;}else{window.oninit=function(){oldoninit();func();};}}function bind(fnc){var args=Array.prototype.slice.call(arguments,1);return function(){return fnc.apply(this,args);};}var timer={_cur_id:0,_handlers:{},execDispatch:function(id){timer._handlers[id]();},add:function(func,timeout){var id=++timer._cur_id;timer._handlers[id]=func;return window.setTimeout('timer.execDispatch('+id+')',timeout);}};function Delay(func,timeout){this.func=func;if(timeout){this.timeout=timeout;}}Delay.prototype={func:null,timeout:500,delTimer:function(){if(this.timer!==null){window.clearTimeout(this.timer);this.timer=null;}},start:function(){this.delTimer();var _this=this;this.timer=timer.add(function(){_this.exec.call(_this);},this.timeout);this._data={_this:arguments[0],_params:Array.prototype.slice.call(arguments,2)};},exec:function(){this.delTimer();this.func.call(this._data._this,this._data._params);}};DokuCookie={data:Array(),name:'DOKU_PREFS',setValue:function(key,val){DokuCookie.init();DokuCookie.data[key]=val;var now=new Date();DokuCookie.fixDate(now);now.setTime(now.getTime()+365*24*60*60*1000);var text='';for(var key in DokuCookie.data){if(!DokuCookie.data.hasOwnProperty(key))continue;text+='#'+escape(key)+'#'+DokuCookie.data[key];}DokuCookie.setCookie(DokuCookie.name,text.substr(1),now,DOKU_BASE);},getValue:function(key){DokuCookie.init();return DokuCookie.data[key];},init:function(){if(DokuCookie.data.length)return;var text=DokuCookie.getCookie(DokuCookie.name);if(text){var parts=text.split('#');for(var i=0;i<parts.length;i+=2){DokuCookie.data[unescape(parts[i])]=unescape(parts[i+1]);}}},setCookie:function(name,value,expires,path,domain,secure){var curCookie=name+"="+escape(value)+((expires)?"; expires="+expires.toGMTString():"")+((path)?"; path="+path:"")+((domain)?"; domain="+domain:"")+((secure)?"; secure":"");document.cookie=curCookie;},getCookie:function(name){var dc=document.cookie;var prefix=name+"=";var begin=dc.indexOf("; "+prefix);if(begin==-1){begin=dc.indexOf(prefix);if(begin!==0){return null;}}else{begin+=2;}var end=document.cookie.indexOf(";",begin);if(end==-1){end=dc.length;}return unescape(dc.substring(begin+prefix.length,end));},fixDate:function(date){var base=new Date(0);var skew=base.getTime();if(skew>0){date.setTime(date.getTime()-skew);}}};var clientPC=navigator.userAgent.toLowerCase();var is_macos=navigator.appVersion.indexOf('Mac')!=-1;var is_gecko=((clientPC.indexOf('gecko')!=-1)&&(clientPC.indexOf('spoofer')==-1)&&(clientPC.indexOf('khtml')==-1)&&(clientPC.indexOf('netscape/7.0')==-1));var is_safari=((clientPC.indexOf('applewebkit')!=-1)&&(clientPC.indexOf('spoofer')==-1));var is_khtml=(navigator.vendor=='KDE'||(document.childNodes&&!document.all&&!navigator.taintEnabled));if(clientPC.indexOf('opera')!=-1){var is_opera=true;var is_opera_preseven=(window.opera&&!document.childNodes);var is_opera_seven=(window.opera&&document.childNodes);}function $(){var elements=new Array();for(var i=0;i<arguments.length;i++){var element=arguments[i];if(typeof element=='string')element=document.getElementById(element);if(arguments.length==1)return element;elements.push(element);}return elements;}function isset(varname){return(typeof(window[varname])!='undefined');}function getElementsByClass(searchClass,node,tag){var classElements=new Array();if(node==null)node=document;if(tag==null)tag='*';var els=node.getElementsByTagName(tag);var elsLen=els.length;var pattern=new RegExp("(^|\\s)"+searchClass+"(\\s|$)");for(var i=0,j=0;i<elsLen;i++){if(pattern.test(els[i].className)){classElements[j]=els[i];j++;}}return classElements;}function findPosX(object){var curleft=0;var obj=$(object);if(obj.offsetParent){do{curleft+=obj.offsetLeft;}while(obj=obj.offsetParent);}else if(obj.x){curleft+=obj.x;}return curleft;}function findPosY(object){var curtop=0;var obj=$(object);if(obj.offsetParent){do{curtop+=obj.offsetTop;}while(obj=obj.offsetParent);}else if(obj.y){curtop+=obj.y;}return curtop;}function jsEscape(text){var re=new RegExp("\\\\","g");text=text.replace(re,"\\\\");re=new RegExp("'","g");text=text.replace(re,"\\'");re=new RegExp('"',"g");text=text.replace(re,'&quot;');re=new RegExp("\\\\\\\\n","g");text=text.replace(re,"\\n");return text;}function escapeQuotes(text){var re=new RegExp("'","g");text=text.replace(re,"\\'");re=new RegExp('"',"g");text=text.replace(re,'&quot;');re=new RegExp("\\n","g");text=text.replace(re,"\\n");return text;}function prependChild(parent,element){if(!parent.firstChild){parent.appendChild(element);}else{parent.insertBefore(element,parent.firstChild);}}function showLoadBar(){document.write('<img src="'+DOKU_BASE+'lib/images/loading.gif" '+'width="150" height="12" alt="..." />');}function hideLoadBar(id){obj=$(id);if(obj)obj.style.display="none";}function addTocToggle(){if(!document.getElementById)return;var header=$('toc__header');if(!header)return;var toc=$('toc__inside');var obj=document.createElement('span');obj.id='toc__toggle';obj.style.cursor='pointer';if(toc&&toc.style.display=='none'){obj.innerHTML='<span>+</span>';obj.className='toc_open';}else{obj.innerHTML='<span>&minus;</span>';obj.className='toc_close';}prependChild(header,obj);obj.parentNode.onclick=toggleToc;obj.parentNode.style.cursor='pointer';}function toggleToc(){var toc=$('toc__inside');var obj=$('toc__toggle');if(toc.style.display=='none'){toc.style.display='';obj.innerHTML='<span>&minus;</span>';obj.className='toc_close';}else{toc.style.display='none';obj.innerHTML='<span>+</span>';obj.className='toc_open';}}function insitu_popup(target,popup_id){var fndiv=$(popup_id);if(!fndiv){fndiv=document.createElement('div');fndiv.id=popup_id;fndiv.className='insitu-footnote JSpopup dokuwiki';addEvent(fndiv,'mouseout',function(e){var p=e.relatedTarget||e.toElement;while(p&&p!==this){p=p.parentNode;}if(p===this){return;}this.style.display='none';});getElementsByClass('dokuwiki',document.body,'div')[0].appendChild(fndiv);}fndiv.style.position='absolute';fndiv.style.left=findPosX(target)+'px';fndiv.style.top=(findPosY(target)+target.offsetHeight*1.5)+'px';fndiv.style.display='';return fndiv;}function footnote(e){var fndiv=insitu_popup(e.target,'insitu__fn');var a=$("fn__"+e.target.id.substr(5));if(!a){return;}var content=new String(a.parentNode.parentNode.innerHTML);content=content.replace(/<sup>.*<\/sup>/gi,'');content=content.replace(/^\s+(,\s+)+/,'');content=content.replace(/\bid=(['"])([^"']+)\1/gi,'id="insitu__$2');fndiv.innerHTML=content;}addInitEvent(function(){var elems=getElementsByClass('fn_top',null,'a');for(var i=0;i<elems.length;i++){addEvent(elems[i],'mouseover',function(e){footnote(e);});}});function initSizeCtl(ctlid,edid){if(!document.getElementById){return;}var ctl=$(ctlid);var textarea=$(edid);if(!ctl||!textarea)return;var hgt=DokuCookie.getValue('sizeCtl');if(hgt){textarea.style.height=hgt;}else{textarea.style.height='300px';}var wrp=DokuCookie.getValue('wrapCtl');if(wrp){setWrap(textarea,wrp);}var l=document.createElement('img');var s=document.createElement('img');var w=document.createElement('img');l.src=DOKU_BASE+'lib/images/larger.gif';s.src=DOKU_BASE+'lib/images/smaller.gif';w.src=DOKU_BASE+'lib/images/wrap.gif';addEvent(l,'click',function(){sizeCtl(edid,100);});addEvent(s,'click',function(){sizeCtl(edid,-100);});addEvent(w,'click',function(){toggleWrap(edid);});ctl.appendChild(l);ctl.appendChild(s);ctl.appendChild(w);}function sizeCtl(edid,val){var textarea=$(edid);var height=parseInt(textarea.style.height.substr(0,textarea.style.height.length-2));height+=val;textarea.style.height=height+'px';DokuCookie.setValue('sizeCtl',textarea.style.height);}function toggleWrap(edid){var textarea=$(edid);var wrap=textarea.getAttribute('wrap');if(wrap&&wrap.toLowerCase()=='off'){setWrap(textarea,'soft');}else{setWrap(textarea,'off');}DokuCookie.setValue('wrapCtl',textarea.getAttribute('wrap'));}function setWrap(textarea,wrapAttrValue){textarea.setAttribute('wrap',wrapAttrValue);var parNod=textarea.parentNode;var nxtSib=textarea.nextSibling;parNod.removeChild(textarea);parNod.insertBefore(textarea,nxtSib);}function closePopups(){if(!document.getElementById){return;}var divs=document.getElementsByTagName('div');for(var i=0;i<divs.length;i++){if(divs[i].className.indexOf('JSpopup')!=-1){divs[i].style.display='none';}}}function scrollToMarker(){var obj=$('scroll__here');if(obj)obj.scrollIntoView();}function focusMarker(){var obj=$('focus__this');if(obj)obj.focus();}function cleanMsgArea(){var elems=getElementsByClass('(success|info|error)',document,'div');if(elems){for(var i=0;i<elems.length;i++){elems[i].style.display='none';}}}addInitEvent(function(){var revForm=$('page__revisions');if(!revForm)return;var elems=revForm.elements;var countTicks=0;for(var i=0;i<elems.length;i++){var input1=elems[i];if(input1.type=='checkbox'){addEvent(input1,'click',function(e){if(this.checked)countTicks++;else countTicks--;for(var j=0;j<elems.length;j++){var input2=elems[j];if(countTicks>=2)input2.disabled=(input2.type=='checkbox'&&!input2.checked);else input2.disabled=(input2.type!='checkbox');}});input1.checked=false;}else if(input1.type=='submit'){input1.disabled=true;}}});addInitEvent(function(){var selector=$('action__selector');if(!selector)return;addEvent(selector,'change',function(e){this.form.submit();});$('action__selectorbtn').style.display='none';});function checkWindowsShares(){if(!LANG['nosmblinks'])return true;if(document.all!=null)return true;var elems=getElementsByClass('windows',document,'a');if(elems){for(var i=0;i<elems.length;i++){var share=elems[i];addEvent(share,'click',function(){alert(LANG['nosmblinks']);});}}}addInitEvent(function(){checkWindowsShares();});addInitEvent(function(){var btns=getElementsByClass('btn_secedit',document,'form');for(var i=0;i<btns.length;i++){addEvent(btns[i],'mouseover',function(e){var tgt=this.parentNode;var nr=tgt.className.match(/(\s+|^)editbutton_(\d+)(\s+|$)/)[2];do{tgt=tgt.previousSibling;}while(tgt!==null&&typeof tgt.tagName==='undefined');if(tgt===null)return;while(typeof tgt.className==='undefined'||tgt.className.match('(\\s+|^)sectionedit'+nr+'(\\s+|$)')===null){if(typeof tgt.className!=='undefined'){tgt.className+=' section_highlight';}tgt=(tgt.previousSibling!==null)?tgt.previousSibling:tgt.parentNode;}if(typeof tgt.className!=='undefined')tgt.className+=' section_highlight';});addEvent(btns[i],'mouseout',function(e){var secs=getElementsByClass('section_highlight');for(var j=0;j<secs.length;j++){secs[j].className=secs[j].className.replace(/section_highlight/g,'');}});}});function sack(file){this.AjaxFailedAlert="Your browser does not support the enhanced functionality of this website, and therefore you will have an experience that differs from the intended one.\n";this.requestFile=file;this.method="POST";this.URLString="";this.encodeURIString=true;this.execute=false;this.asynchronous=true;this.onLoading=function(){};this.onLoaded=function(){};this.onInteractive=function(){};this.onCompletion=function(){};this.afterCompletion=function(){};this.createAJAX=function(){try{this.xmlhttp=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{this.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}catch(err){this.xmlhttp=null;}}if(!this.xmlhttp&&typeof XMLHttpRequest!="undefined"){this.xmlhttp=new XMLHttpRequest();}if(!this.xmlhttp){this.failed=true;}};this.setVar=function(name,value){if(this.URLString.length<3){this.URLString=name+"="+value;}else{this.URLString+="&"+name+"="+value;}};this.encVar=function(name,value){var varString=encodeURIComponent(name)+"="+encodeURIComponent(value);return varString;};this.encodeURLString=function(string){varArray=string.split('&');for(i=0;i<varArray.length;i++){urlVars=varArray[i].split('=');if(urlVars[0].indexOf('amp;')!=-1){urlVars[0]=urlVars[0].substring(4);}varArray[i]=this.encVar(urlVars[0],urlVars[1]);}return varArray.join('&');};this.runResponse=function(){eval(this.response);};this.runAJAX=function(urlstring){this.responseStatus=new Array(2);if(this.failed&&this.AjaxFailedAlert){alert(this.AjaxFailedAlert);}else{if(urlstring){if(this.URLString.length){this.URLString=this.URLString+"&"+urlstring;}else{this.URLString=urlstring;}}if(this.encodeURIString){var timeval=new Date().getTime();this.URLString=this.encodeURLString(this.URLString);this.setVar("rndval",timeval);}if(this.element){this.elementObj=document.getElementById(this.element);}if(this.xmlhttp){var self=this;if(this.method=="GET"){var totalurlstring=this.requestFile+"?"+this.URLString;this.xmlhttp.open(this.method,totalurlstring,this.asynchronous);}else{this.xmlhttp.open(this.method,this.requestFile,this.asynchronous);}if(this.method=="POST"){try{this.xmlhttp.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');}catch(e){}}this.xmlhttp.onreadystatechange=function(){switch(self.xmlhttp.readyState){case 1:self.onLoading();break;case 2:self.onLoaded();break;case 3:self.onInteractive();break;case 4:self.response=self.xmlhttp.responseText;self.responseXML=self.xmlhttp.responseXML;self.responseStatus[0]=self.xmlhttp.status;self.responseStatus[1]=self.xmlhttp.statusText;self.onCompletion();if(self.execute){self.runResponse();}if(self.elementObj){var elemNodeName=self.elementObj.nodeName;elemNodeName.toLowerCase();if(elemNodeName=="input"||elemNodeName=="select"||elemNodeName=="option"||elemNodeName=="textarea"){self.elementObj.value=self.response;}else{self.elementObj.innerHTML=self.response;}}self.afterCompletion();self.URLString="";break;}};this.xmlhttp.send(this.URLString);}}};this.createAJAX();}addInitEvent(function(){var inID='qsearch__in';var outID='qsearch__out';var inObj=document.getElementById(inID);var outObj=document.getElementById(outID);if(inObj===null){return;}if(outObj===null){return;}function clear_results(){outObj.style.display='none';outObj.innerHTML='';}var sack_obj=new sack(DOKU_BASE+'lib/exe/ajax.php');sack_obj.AjaxFailedAlert='';sack_obj.encodeURIString=false;sack_obj.onCompletion=function(){var data=sack_obj.response;if(data===''){return;}outObj.innerHTML=data;outObj.style.display='block';};var delay=new Delay(function(){clear_results();var value=inObj.value;if(value===''){return;}sack_obj.runAJAX('call=qsearch&q='+encodeURI(value));});addEvent(inObj,'keyup',function(){clear_results();delay.start();});addEvent(outObj,'click',function(){outObj.style.display='none';});});var index={throbber_delay:500,treeattach:function(obj){if(!obj)return;var items=getElementsByClass('idx_dir',obj,'a');for(var i=0;i<items.length;i++){var elem=items[i];addEvent(elem,'click',function(e){return index.toggle(e,this);});var listitem=elem.parentNode;while(listitem.tagName!='LI'){listitem=listitem.parentNode;}if(listitem.getElementsByTagName('ul').length){listitem.open=true;}}},toggle:function(e,clicky){var listitem=clicky.parentNode.parentNode;listitem.open=!listitem.open;var sublists=listitem.getElementsByTagName('ul');if(!listitem.open){if(sublists.length){sublists[0].style.display='none';}listitem.className='closed';e.preventDefault();return false;}if(sublists.length&&listitem.open){sublists[0].style.display='';listitem.className='open';e.preventDefault();return false;}var ajax=new sack(DOKU_BASE+'lib/exe/ajax.php');ajax.AjaxFailedAlert='';ajax.encodeURIString=false;if(ajax.failed)return true;var ul=document.createElement('ul');ul.className='idx';timeout=window.setTimeout(function(){if(listitem.open){ul.innerHTML='<li><img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="loading..." title="loading..." /></li>';listitem.appendChild(ul);listitem.className='open';}},this.throbber_delay);ajax.elementObj=ul;ajax.afterCompletion=function(){window.clearTimeout(timeout);index.treeattach(ul);if(listitem.className!='open'){if(!listitem.open){ul.style.display='none';}listitem.appendChild(ul);if(listitem.open){listitem.className='open';}}};ajax.runAJAX(clicky.search.substr(1)+'&call=index');e.preventDefault();return false;}};addInitEvent(function(){index.treeattach($('index__tree'));});var drag={obj:null,handle:null,oX:0,oY:0,eX:0,eY:0,attach:function(obj,handle){if(handle){handle.dragobject=obj;}else{handle=obj;}var _this=this;addEvent($(handle),'mousedown',function(e){return _this.start(e);});},start:function(e){this.handle=e.target;if(this.handle.dragobject){this.obj=this.handle.dragobject;}else{this.obj=this.handle;}this.handle.className+=' ondrag';this.obj.className+=' ondrag';this.oX=parseInt(this.obj.style.left);this.oY=parseInt(this.obj.style.top);this.eX=e.pageX;this.eY=e.pageY;var _this=this;this.mousehandlers=[function(e){return _this.drag(e);},function(e){return _this.stop(e);}];addEvent(document,'mousemove',this.mousehandlers[0]);addEvent(document,'mouseup',this.mousehandlers[1]);return false;},stop:function(){this.handle.className=this.handle.className.replace(/ ?ondrag/,'');this.obj.className=this.obj.className.replace(/ ?ondrag/,'');removeEvent(document,'mousemove',this.mousehandlers[0]);removeEvent(document,'mouseup',this.mousehandlers[1]);this.obj=null;this.handle=null;},drag:function(e){if(this.obj){this.obj.style.top=(e.pageY+this.oY-this.eY+'px');this.obj.style.left=(e.pageX+this.oX-this.eX+'px');}}};function selection_class(){this.start=0;this.end=0;this.obj=null;this.rangeCopy=null;this.scroll=0;this.fix=0;this.getLength=function(){return this.end-this.start;};this.getText=function(){if(!this.obj)return'';return this.obj.value.substring(this.start,this.end);};}function getSelection(textArea){var sel=new selection_class();sel.obj=textArea;sel.start=textArea.value.length;sel.end=textArea.value.length;textArea.focus();if(document.getSelection){sel.start=textArea.selectionStart;sel.end=textArea.selectionEnd;sel.scroll=textArea.scrollTop;}else if(document.selection){sel.rangeCopy=document.selection.createRange().duplicate();if(textArea.tagName==='INPUT'){var before_range=textArea.createTextRange();before_range.expand('textedit');}else{var before_range=document.body.createTextRange();before_range.moveToElementText(textArea);}before_range.setEndPoint("EndToStart",sel.rangeCopy);var before_finished=false,selection_finished=false;var before_text,selection_text;before_text=before_range.text;selection_text=sel.rangeCopy.text;sel.start=before_text.length;sel.end=sel.start+selection_text.length;do{if(!before_finished){if(before_range.compareEndPoints("StartToEnd",before_range)==0){before_finished=true;}else{before_range.moveEnd("character",-1);if(before_range.text==before_text){sel.start+=2;sel.end+=2;}else{before_finished=true;}}}if(!selection_finished){if(sel.rangeCopy.compareEndPoints("StartToEnd",sel.rangeCopy)==0){selection_finished=true;}else{sel.rangeCopy.moveEnd("character",-1);if(sel.rangeCopy.text==selection_text){sel.end+=2;}else{selection_finished=true;}}}}while((!before_finished||!selection_finished));var countNL=function(str){var m=str.split("\r\n");if(!m||!m.length)return 0;return m.length-1;};sel.fix=countNL(sel.obj.value.substring(0,sel.start));}return sel;}function setSelection(selection){if(document.getSelection){selection.obj.setSelectionRange(selection.start,selection.end);if(selection.scroll)selection.obj.scrollTop=selection.scroll;}else if(document.selection){selection.rangeCopy.collapse(true);selection.rangeCopy.moveStart('character',selection.start-selection.fix);selection.rangeCopy.moveEnd('character',selection.end-selection.start);selection.rangeCopy.select();}}function pasteText(selection,text,opts){if(!opts)opts={};selection.obj.value=selection.obj.value.substring(0,selection.start)+text+selection.obj.value.substring(selection.end,selection.obj.value.length);if(is_opera){selection.end=selection.start+text.replace(/\r?\n/g,'\r\n').length;}else{selection.end=selection.start+text.length;}if(opts.startofs)selection.start+=opts.startofs;if(opts.endofs)selection.end-=opts.endofs;if(opts.nosel)selection.start=selection.end;setSelection(selection);}function insertTags(textAreaID,tagOpen,tagClose,sampleText){var txtarea=$(textAreaID);var selection=getSelection(txtarea);var text=selection.getText();var opts;if(text.charAt(text.length-1)==' '){selection.end--;text=selection.getText();}if(!text){text=sampleText;opts={startofs:tagOpen.length,endofs:tagClose.length};}else{opts={nosel:true};}text=tagOpen+text+tagClose;pasteText(selection,text,opts);}function insertAtCarret(textAreaID,text){var txtarea=$(textAreaID);var selection=getSelection(txtarea);pasteText(selection,text,{nosel:true});}var pickercounter=0;function initToolbar(tbid,edid,tb,allowblock){var toolbar=$(tbid);if(!toolbar)return;var edit=$(edid);if(!edit)return;if(edit.readOnly)return;if(typeof allowblock==='undefined'){allowblock=true;}toolbar.innerHTML='';var cnt=tb.length;for(var i=0;i<cnt;i++){if(!allowblock&&tb[i].block===true){continue;}var actionFunc;var btn=createToolButton(tb[i]['icon'],tb[i]['title'],tb[i]['key'],tb[i]['id'],tb[i]['class']);actionFunc='tb_'+tb[i]['type'];if(isFunction(window[actionFunc])){addEvent(btn,'click',bind(window[actionFunc],btn,tb[i],edid));toolbar.appendChild(btn);continue;}actionFunc='addBtnAction'+tb[i]['type'].charAt(0).toUpperCase()+tb[i]['type'].substring(1);if(isFunction(window[actionFunc])){if(window[actionFunc](btn,tb[i],edid)){toolbar.appendChild(btn);}continue;}alert('unknown toolbar type: '+tb[i]['type']+'  '+actionFunc);}}function tb_format(btn,props,edid){var sample=props['title'];if(props['sample']){sample=props['sample'];}insertTags(edid,fixtxt(props['open']),fixtxt(props['close']),fixtxt(sample));pickerClose();return false;}function tb_formatln(btn,props,edid){var sample=props['title'];if(props['sample']){sample=props['sample'];}sample=fixtxt(sample);props['open']=fixtxt(props['open']);props['close']=fixtxt(props['close']);var opts;var selection=getSelection($(edid));if(selection.getLength()){sample=selection.getText();opts={nosel:true};}else{opts={startofs:props['open'].length,endofs:props['close'].length};}sample=sample.split("\n").join(props['close']+"\n"+props['open']);sample=props['open']+sample+props['close'];pasteText(selection,sample,opts);pickerClose();return false;}function tb_insert(btn,props,edid){insertAtCarret(edid,fixtxt(props['insert']));pickerClose();return false;}function tb_mediapopup(btn,props,edid){window.open(DOKU_BASE+props['url']+encodeURIComponent(NS),props['name'],props['options']);return false;}function tb_autohead(btn,props,edid){var lvl=currentHeadlineLevel(edid);lvl+=props['mod'];if(lvl<1)lvl=1;if(lvl>5)lvl=5;var tags='=';for(var i=0;i<=5-lvl;i++)tags+='=';insertTags(edid,tags+' ',' '+tags+"\n",props['text']);pickerClose();return false;}function addBtnActionPicker(btn,props,edid){var pickerid='picker'+(pickercounter++);createPicker(pickerid,props,edid);addEvent(btn,'click',function(){pickerToggle(pickerid,btn);return false;});return true;}function addBtnActionLinkwiz(btn,props,edid){linkwiz.init($(edid));addEvent(btn,'click',function(){linkwiz.toggle();return false;});return true;}function pickerToggle(pickerid,btn){var picker=$(pickerid);if(picker.style.marginLeft=='-10000px'){var x=findPosX(btn);var y=findPosY(btn);picker.style.left=(x+3)+'px';picker.style.top=(y+btn.offsetHeight+3)+'px';picker.style.marginLeft='0px';picker.style.marginTop='0px';}else{picker.style.marginLeft='-10000px';picker.style.marginTop='-10000px';}}function pickerClose(){var pobjs=getElementsByClass('picker');for(var i=0;i<pobjs.length;i++){pobjs[i].style.marginLeft='-10000px';pobjs[i].style.marginTop='-10000px';}}function fixtxt(str){return str.replace(/\\n/g,"\n");}function createToolButton(icon,label,key,id,classname){var btn=document.createElement('button');var ico=document.createElement('img');btn.className='toolbutton';if(classname){btn.className+=' '+classname;}btn.title=label;if(key){btn.title+=' ['+key.toUpperCase()+']';btn.accessKey=key;}if(id){btn.id=id;ico.id=id+'_ico';}if(icon.substr(0,1)=='/'){ico.src=icon;}else{ico.src=DOKU_BASE+'lib/images/toolbar/'+icon;}btn.appendChild(ico);return btn;}function createPicker(id,props,edid){var icobase=props['icobase'];var list=props['list'];var picker=document.createElement('div');picker.className='picker';if(props['class']){picker.className+=' '+props['class'];}picker.id=id;picker.style.position='absolute';picker.style.marginLeft='-10000px';picker.style.marginTop='-10000px';for(var key in list){if(!list.hasOwnProperty(key))continue;if(isNaN(key)){var btn=document.createElement('button');btn.className='pickerbutton';var ico=document.createElement('img');if(list[key].substr(0,1)=='/'){ico.src=list[key];}else{ico.src=DOKU_BASE+'lib/images/'+icobase+'/'+list[key];}btn.title=key;btn.appendChild(ico);addEvent(btn,'click',bind(pickerInsert,key,edid));picker.appendChild(btn);}else if(isString(list[key])){var btn=document.createElement('button');btn.className='pickerbutton';var txt=document.createTextNode(list[key]);btn.title=list[key];btn.appendChild(txt);addEvent(btn,'click',bind(pickerInsert,list[key],edid));picker.appendChild(btn);}else{initToolbar(picker,edid,list);break;}}var body=document.getElementsByTagName('body')[0];body.appendChild(picker);return picker;}function pickerInsert(text,edid){insertAtCarret(edid,text);pickerClose();}function addBtnActionSignature(btn,props,edid){if(typeof(SIG)!='undefined'&&SIG!=''){addEvent(btn,'click',bind(insertAtCarret,edid,SIG));return true;}return false;}function keyHandler(e){if(e.keyCode!=13&&e.keyCode!=8&&e.keyCode!=32)return;var field=e.target;var selection=getSelection(field);if(selection.getLength())return;var search="\n"+field.value.substr(0,selection.start);var linestart=Math.max(search.lastIndexOf("\n"),search.lastIndexOf("\r"));search=search.substr(linestart);if(e.keyCode==13){var match=search.match(/(\n  +([\*-] ?)?)/);if(match){var scroll=field.scrollHeight;var match2=search.match(/^\n  +[\*-]\s*$/);if(match2&&field.value.substr(selection.start).match(/^($|\r?\n)/)){field.value=field.value.substr(0,linestart)+"\n"+field.value.substr(selection.start);selection.start=linestart+1;selection.end=linestart+1;setSelection(selection);}else{insertAtCarret(field.id,match[1]);}field.scrollTop+=(field.scrollHeight-scroll);e.preventDefault();return false;}}else if(e.keyCode==8){var match=search.match(/(\n  +)([*-] ?)$/);if(match){var spaces=match[1].length-1;if(spaces>3){field.value=field.value.substr(0,linestart)+field.value.substr(linestart+2);selection.start=selection.start-2;selection.end=selection.start;}else{field.value=field.value.substr(0,linestart)+field.value.substr(selection.start);selection.start=linestart;selection.end=linestart;}setSelection(selection);e.preventDefault();return false;}}else if(e.keyCode==32){var match=search.match(/(\n  +)([*-] )$/);if(match){field.value=field.value.substr(0,linestart)+'  '+field.value.substr(linestart);selection.start=selection.start+2;selection.end=selection.start;setSelection(selection);e.preventDefault();return false;}}}addInitEvent(function(){var field=$('wiki__text');if(!field)return;if(is_opera){addEvent(field,'keypress',keyHandler);}else{addEvent(field,'keydown',keyHandler);}});function currentHeadlineLevel(textboxId){var field=$(textboxId);var selection=getSelection(field);var search="\n"+field.value.substr(0,selection.start);var lasthl=search.lastIndexOf("\n==");if(lasthl==-1&&field.form.prefix){search=field.form.prefix.value;lasthl=search.lastIndexOf("\n==");}search=search.substr(lasthl+1,6);if(search=='======')return 1;if(search.substr(0,5)=='=====')return 2;if(search.substr(0,4)=='====')return 3;if(search.substr(0,3)=='===')return 4;if(search.substr(0,2)=='==')return 5;return 0;}var textChanged=false;function deleteDraft(){if(is_opera)return;var dwform=$('dw__editform');if(dwform){var params='call=draftdel';params+='&id='+encodeURIComponent(dwform.elements.id.value);var sackobj=new sack(DOKU_BASE+'lib/exe/ajax.php');sackobj.asynchronous=false;sackobj.method='GET';sackobj.AjaxFailedAlert='';sackobj.encodeURIString=false;sackobj.runAJAX(params);}}addInitEvent(function(){var editform=$('dw__editform');if(!editform)return;var edit_text=$('wiki__text');if(edit_text){if(edit_text.readOnly)return;edit_text.focus();}var checkfunc=function(){textChanged=true;summaryCheck();};addEvent(editform,'change',checkfunc);addEvent(editform,'keydown',checkfunc);window.onbeforeunload=function(){if(textChanged){return LANG.notsavedyet;}};window.onunload=deleteDraft;addEvent($('edbtn__save'),'click',function(){textChanged=false;});addEvent($('edbtn__preview'),'click',function(){textChanged=false;});var summary=$('edit__summary');addEvent(summary,'change',summaryCheck);addEvent(summary,'keyup',summaryCheck);if(textChanged)summaryCheck();});function summaryCheck(){var sum=document.getElementById('edit__summary');if(sum.value===''){sum.className='missing';}else{sum.className='edit';}}function locktimer_class(){this.sack=null;this.timeout=0;this.timerID=null;this.lasttime=null;this.msg='';this.pageid='';};var locktimer=new locktimer_class();locktimer.init=function(timeout,msg,draft){locktimer.timeout=timeout*1000;locktimer.msg=msg;locktimer.draft=draft;locktimer.lasttime=new Date();if(!$('dw__editform'))return;locktimer.pageid=$('dw__editform').elements.id.value;if(!locktimer.pageid)return;locktimer.sack=new sack(DOKU_BASE+'lib/exe/ajax.php');locktimer.sack.AjaxFailedAlert='';locktimer.sack.encodeURIString=false;locktimer.sack.onCompletion=locktimer.refreshed;addEvent($('dw__editform'),'keypress',function(){locktimer.refresh();});locktimer.reset();};locktimer.reset=function(){locktimer.clear();locktimer.timerID=window.setTimeout("locktimer.warning()",locktimer.timeout);};locktimer.warning=function(){locktimer.clear();alert(locktimer.msg);};locktimer.clear=function(){if(locktimer.timerID!==null){window.clearTimeout(locktimer.timerID);locktimer.timerID=null;}};locktimer.refresh=function(){var now=new Date();if(now.getTime()-locktimer.lasttime.getTime()>30*1000){var params='call=lock&id='+encodeURIComponent(locktimer.pageid);var dwform=$('dw__editform');if(locktimer.draft&&dwform.elements.wikitext){params+='&prefix='+encodeURIComponent(dwform.elements.prefix.value);params+='&wikitext='+encodeURIComponent(dwform.elements.wikitext.value);params+='&suffix='+encodeURIComponent(dwform.elements.suffix.value);if(dwform.elements.date){params+='&date='+encodeURIComponent(dwform.elements.date.value);}}locktimer.sack.runAJAX(params);locktimer.lasttime=now;}};locktimer.refreshed=function(){var data=this.response;var error=data.charAt(0);data=data.substring(1);$('draft__status').innerHTML=data;if(error!='1')return;locktimer.reset();};var linkwiz={wiz:null,entry:null,result:null,timer:null,sack:null,textArea:null,selected:-1,selection:null,init:function(textArea){linkwiz.sack=new sack(DOKU_BASE+'lib/exe/ajax.php');linkwiz.sack.AjaxFailedAlert='';linkwiz.sack.encodeURIString=false;linkwiz.wiz=document.createElement('div');linkwiz.wiz.id='link__wiz';linkwiz.wiz.className='picker';linkwiz.wiz.style.top=(findPosY(textArea)+20)+'px';linkwiz.wiz.style.left=(findPosX(textArea)+80)+'px';linkwiz.wiz.style.marginLeft='-10000px';linkwiz.wiz.style.marginTop='-10000px';linkwiz.wiz.style.position='absolute';linkwiz.wiz.innerHTML='<div id="link__wiz_header">'+'<img src="'+DOKU_BASE+'lib/images/close.png" width="16" height="16" align="right" alt="" id="link__wiz_close" />'+LANG['linkwiz']+'</div>'+'<div>'+LANG['linkto']+' <input type="text" class="edit" id="link__wiz_entry" autocomplete="off" /></div>'+'<div id="link__wiz_result"></div>';$('dw__editform').parentNode.appendChild(linkwiz.wiz);linkwiz.textArea=textArea;linkwiz.result=$('link__wiz_result');linkwiz.entry=$('link__wiz_entry');var obj;obj=$('link__wiz_close');obj.onclick=linkwiz.hide;linkwiz.sack.elementObj=linkwiz.result;addEvent(linkwiz.entry,'keyup',linkwiz.onEntry);addEvent(linkwiz.result,'click',linkwiz.onResultClick);drag.attach(linkwiz.wiz,$('link__wiz_header'));},onEntry:function(e){if(e.keyCode==37||e.keyCode==39){return true;}if(e.keyCode==27){linkwiz.hide();e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==38){linkwiz.select(linkwiz.selected-1);e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==40){linkwiz.select(linkwiz.selected+1);e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==13){if(linkwiz.selected>-1){var obj=linkwiz.getResult(linkwiz.selected);if(obj){var a=obj.getElementsByTagName('A')[0];linkwiz.resultClick(a);}}else if(linkwiz.entry.value){linkwiz.insertLink(linkwiz.entry.value);}e.preventDefault();e.stopPropagation();return false;}linkwiz.autocomplete();},getResult:function(num){var obj;var childs=linkwiz.result.getElementsByTagName('DIV');obj=childs[num];if(obj){return obj;}else{return null;}},select:function(num){if(num<0){linkwiz.deselect();return;}var obj=linkwiz.getResult(num);if(obj){linkwiz.deselect();obj.className+=' selected';if(obj.offsetTop>linkwiz.result.scrollTop+linkwiz.result.clientHeight){linkwiz.result.scrollTop+=obj.clientHeight;}else if(obj.offsetTop-linkwiz.result.clientHeight<linkwiz.result.scrollTop){linkwiz.result.scrollTop-=obj.clientHeight;}if((obj.offsetTop>linkwiz.result.scrollTop+linkwiz.result.clientHeight)||(obj.offsetTop<linkwiz.result.scrollTop)){obj.scrollIntoView();}linkwiz.selected=num;}},deselect:function(){if(linkwiz.selected>-1){var obj=linkwiz.getResult(linkwiz.selected);if(obj){obj.className=obj.className.replace(/ ?selected/,'');}}linkwiz.selected=-1;},onResultClick:function(e){if(e.target.tagName!='A')return;e.stopPropagation();e.preventDefault();linkwiz.resultClick(e.target);return false;},resultClick:function(a){var id=a.title;if(id==''||id.substr(id.length-1)==':'){linkwiz.entry.value=id;linkwiz.autocomplete_exec();}else{linkwiz.entry.value=id;if(a.nextSibling&&a.nextSibling.tagName=='SPAN'){linkwiz.insertLink(a.nextSibling.innerHTML);}else{linkwiz.insertLink('');}}},insertLink:function(title){if(!linkwiz.entry.value)return;var sel=getSelection(linkwiz.textArea);if(sel.start==0&&sel.end==0)sel=linkwiz.selection;var stxt=sel.getText();if(stxt.charAt(stxt.length-1)==' '){sel.end--;stxt=sel.getText();}if(!stxt&&!DOKU_UHC)stxt=title;if(linkwiz.textArea.form['id'].value.indexOf(':')!=-1&&linkwiz.entry.value.indexOf(':')==-1){linkwiz.entry.value=':'+linkwiz.entry.value;}var link='[['+linkwiz.entry.value+'|';if(stxt)link+=stxt;link+=']]';var so=linkwiz.entry.value.length+3;var eo=2;pasteText(sel,link,{startofs:so,endofs:eo});linkwiz.hide();linkwiz.entry.value=linkwiz.entry.value.replace(/(^:)?[^:]*$/,'');},autocomplete:function(){if(linkwiz.timer!==null){window.clearTimeout(linkwiz.timer);linkwiz.timer=null;}linkwiz.timer=window.setTimeout(linkwiz.autocomplete_exec,350);},autocomplete_exec:function(){linkwiz.deselect();linkwiz.result.innerHTML='<img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="" width="16" height="16" />';linkwiz.sack.runAJAX('call=linkwiz&q='+encodeURI(linkwiz.entry.value));},clear:function(){linkwiz.result.innerHTML='Search for a matching page name above, or browse through the pages on the right';linkwiz.entry.value='';},show:function(){linkwiz.selection=getSelection(linkwiz.textArea);linkwiz.wiz.style.marginLeft='0px';linkwiz.wiz.style.marginTop='0px';linkwiz.entry.focus();linkwiz.autocomplete();},hide:function(){linkwiz.wiz.style.marginLeft='-10000px';linkwiz.wiz.style.marginTop='-10000px';linkwiz.textArea.focus();},toggle:function(){if(linkwiz.wiz.style.marginLeft=='-10000px'){linkwiz.show();}else{linkwiz.hide();}}};var media_manager={keepopen:false,hide:false,align:false,popup:false,id:false,display:false,link:false,size:false,ext:false,treeattach:function(obj){if(!obj)return;var items=obj.getElementsByTagName('li');for(var i=0;i<items.length;i++){var elem=items[i];var clicky=elem.getElementsByTagName('img')[0];clicky.style.cursor='pointer';addEvent(clicky,'click',function(event){return media_manager.toggle(event,this);});var link=elem.getElementsByTagName('a')[0];link.style.cursor='pointer';addEvent(link,'click',function(event){return media_manager.list(event,this);});}},selectorattach:function(obj){if(!obj)return;var items=getElementsByClass('select',obj,'a');for(var i=0;i<items.length;i++){var elem=items[i];elem.style.cursor='pointer';addEvent(elem,'click',function(event){return media_manager.select(event,this);});}items=getElementsByClass('example',obj,'div');for(var i=0;i<items.length;i++){elem=items[i];elem.style.display='none';}var file=$('upload__file');if(!file)return;addEvent(file,'change',media_manager.suggest);},confirmattach:function(obj){if(!obj)return;items=getElementsByClass('btn_media_delete',obj,'a');for(var i=0;i<items.length;i++){var elem=items[i];addEvent(elem,'click',function(e){if(e.target.tagName=='IMG'){var name=e.target.parentNode.title;}else{var name=e.target.title;}if(!confirm(LANG['del_confirm']+"\n"+name)){e.preventDefault();return false;}else{return true;}});}},attachoptions:function(obj){if(!obj)return;if(opener){var kobox=document.createElement('input');kobox.type='checkbox';kobox.id='media__keepopen';if(DokuCookie.getValue('keepopen')){kobox.checked=true;kobox.defaultChecked=true;media_manager.keepopen=true;}addEvent(kobox,'click',function(event){return media_manager.togglekeepopen(event,this);});var kolbl=document.createElement('label');kolbl.htmlFor='media__keepopen';kolbl.innerHTML=LANG['keepopen'];var kobr=document.createElement('br');obj.appendChild(kobox);obj.appendChild(kolbl);obj.appendChild(kobr);}var hdbox=document.createElement('input');hdbox.type='checkbox';hdbox.id='media__hide';if(DokuCookie.getValue('hide')){hdbox.checked=true;hdbox.defaultChecked=true;media_manager.hide=true;}addEvent(hdbox,'click',function(event){return media_manager.togglehide(event,this);});var hdlbl=document.createElement('label');hdlbl.htmlFor='media__hide';hdlbl.innerHTML=LANG['hidedetails'];var hdbr=document.createElement('br');obj.appendChild(hdbox);obj.appendChild(hdlbl);obj.appendChild(hdbr);media_manager.updatehide();},togglekeepopen:function(event,cb){if(cb.checked){DokuCookie.setValue('keepopen',1);media_manager.keepopen=true;}else{DokuCookie.setValue('keepopen','');media_manager.keepopen=false;}},togglehide:function(event,cb){if(cb.checked){DokuCookie.setValue('hide',1);media_manager.hide=true;}else{DokuCookie.setValue('hide','');media_manager.hide=false;}media_manager.updatehide();},updatehide:function(){var obj=$('media__content');if(!obj)return;var details=getElementsByClass('detail',obj,'div');for(var i=0;i<details.length;i++){if(media_manager.hide){details[i].style.display='none';}else{details[i].style.display='';}}},select:function(event,link){var id=link.name.substr(2);media_manager.id=id;if(!opener){var ex=$('ex_'+id.replace(/:/g,'_'));if(ex.style.display==''){ex.style.display='none';}else{ex.style.display='';}return false;}opener.insertTags('wiki__text','{{'+id+'|','}}','');if(!media_manager.keepopen)window.close();opener.focus();return false;media_manager.ext=false;var dot=id.lastIndexOf(".");if(dot!=-1){var ext=id.substr(dot,id.length);if(ext!='.jpg'&&ext!='.jpeg'&&ext!='.png'&&ext!='.gif'&&ext!='.swf'){media_manager.insert(null);return false;}}else{media_manager.insert(null);return false;}media_manager.popup.style.display='inline';media_manager.popup.style.left=event.pageX+'px';media_manager.popup.style.top=event.pageY+'px';media_manager.outSet('media__linkbtn1');media_manager.outSet('media__linkbtn2');media_manager.outSet('media__linkbtn3');media_manager.outSet('media__linkbtn4');media_manager.outSet('media__alignbtn0');media_manager.outSet('media__alignbtn1');media_manager.outSet('media__alignbtn2');media_manager.outSet('media__alignbtn3');media_manager.outSet('media__sizebtn1');media_manager.outSet('media__sizebtn2');media_manager.outSet('media__sizebtn3');media_manager.outSet('media__sizebtn4');if(ext=='.swf'){media_manager.ext='swf';$('media__linkbtn1').style.display='none';$('media__linkbtn2').style.display='none';if(media_manager.link!=false){if(media_manager.link=='2'||media_manager.link=='1'){media_manager.inSet('media__linkbtn3');media_manager.link='3';DokuCookie.setValue('link','3');}else{media_manager.inSet('media__linkbtn'+media_manager.link);}}else if(DokuCookie.getValue('link')){if(DokuCookie.getValue('link')=='2'||DokuCookie.getValue('link')=='1'){media_manager.inSet('media__linkbtn3');media_manager.link='3';DokuCookie.setValue('link','3');}else{media_manager.inSet('media__linkbtn'+DokuCookie.getValue('link'));media_manager.link=DokuCookie.getValue('link');}}else{media_manager.link='3';media_manager.inSet('media__linkbtn3');DokuCookie.setValue('link','3');}$('media__sizebtn4').style.display='none';}else{media_manager.ext='img';$('media__linkbtn1').style.display='inline';$('media__linkbtn2').style.display='inline';$('media__sizebtn4').style.display='inline';if(DokuCookie.getValue('link')){media_manager.link=DokuCookie.getValue('link');}if(media_manager.link==false){media_manager.link='1';DokuCookie.setValue('link','1');}media_manager.inSet('media__linkbtn'+media_manager.link);}if(media_manager.link=='4'){media_manager.align=false;media_manager.size=false;$('media__align').style.display='none';$('media__size').style.display='none';}else{$('media__align').style.display='block';$('media__size').style.display='block';if(media_manager.align!=false){media_manager.inSet('media__alignbtn'+media_manager.align);}else if(DokuCookie.getValue('align')){media_manager.inSet('media__alignbtn'+DokuCookie.getValue('align'));media_manager.align=DokuCookie.getValue('align');}else{media_manager.align='0';media_manager.inSet('media__alignbtn0');DokuCookie.setValue('align','0');}if(DokuCookie.getValue('size')){media_manager.size=DokuCookie.getValue('size');}if(media_manager.size==false||(media_manager.size==='4'&&ext==='.swf')){media_manager.size='2';DokuCookie.setValue('size','2');}media_manager.inSet('media__sizebtn'+media_manager.size);$('media__sendbtn').focus();}return false;},initpopup:function(){media_manager.popup=document.createElement('div');media_manager.popup.setAttribute('id','media__popup');var root=document.getElementById('media__manager');if(root==null)return;root.appendChild(media_manager.popup);var headline=document.createElement('h1');headline.innerHTML=LANG.mediatitle;var headlineimg=document.createElement('img');headlineimg.src=DOKU_BASE+'lib/images/close.png';headlineimg.id='media__closeimg';addEvent(headlineimg,'click',function(event){return media_manager.closePopup(event,this);});headline.insertBefore(headlineimg,headline.firstChild);media_manager.popup.appendChild(headline);drag.attach(media_manager.popup,headline);var linkp=document.createElement('p');linkp.id="media__linkstyle";if(media_manager.display=="2"){linkp.style.display="none";}var linkl=document.createElement('label');linkl.innerHTML=LANG.mediatarget;linkp.appendChild(linkl);var linkbtns=['lnk','direct','nolnk','displaylnk'];for(var i=0;i<linkbtns.length;++i){var linkbtn=document.createElement('button');linkbtn.className='button';linkbtn.value=i+1;linkbtn.id="media__linkbtn"+(i+1);linkbtn.title=LANG['media'+linkbtns[i]];linkbtn.style.borderStyle='outset';addEvent(linkbtn,'click',function(event){return media_manager.setlink(event,this);});var linkimg=document.createElement('img');linkimg.src=DOKU_BASE+'lib/images/media_link_'+linkbtns[i]+'.png';linkbtn.appendChild(linkimg);linkp.appendChild(linkbtn);}media_manager.popup.appendChild(linkp);var alignp=document.createElement('p');var alignl=document.createElement('label');alignp.appendChild(alignl);alignp.id='media__align';if(media_manager.display=="2"){alignp.style.display="none";}alignl.innerHTML=LANG['mediaalign'];var alignbtns=['noalign','left','center','right'];for(var n=0;n<alignbtns.length;++n){var alignbtn=document.createElement('button');var alignimg=document.createElement('img');alignimg.src=DOKU_BASE+'lib/images/media_align_'+alignbtns[n]+'.png';alignbtn.id="media__alignbtn"+n;alignbtn.value=n;alignbtn.title=LANG['media'+alignbtns[n]];alignbtn.className='button';alignbtn.appendChild(alignimg);alignbtn.style.borderStyle='outset';addEvent(alignbtn,'click',function(event){return media_manager.setalign(event,this);});alignp.appendChild(alignbtn);}media_manager.popup.appendChild(alignp);var sizep=document.createElement('p');var sizel=document.createElement('label');sizep.id='media__size';if(media_manager.display=="2"){sizep.style.display="none";}sizep.appendChild(sizel);sizel.innerHTML=LANG['mediasize'];var sizebtns=['small','medium','large','original'];for(var size=0;size<sizebtns.length;++size){var sizebtn=document.createElement('button');var sizeimg=document.createElement('img');sizep.appendChild(sizebtn);sizeimg.src=DOKU_BASE+'lib/images/media_size_'+sizebtns[size]+'.png';sizebtn.className='button';sizebtn.appendChild(sizeimg);sizebtn.value=size+1;sizebtn.id='media__sizebtn'+(size+1);sizebtn.title=LANG['media'+sizebtns[size]];sizebtn.style.borderStyle='outset';addEvent(sizebtn,'click',function(event){return media_manager.setsize(event,this);});}media_manager.popup.appendChild(sizep);var btnp=document.createElement('p');media_manager.popup.appendChild(btnp);btnp.setAttribute('class','btnlbl');var btn=document.createElement('input');btn.type='button';btn.id='media__sendbtn';btn.setAttribute('class','button');btn.value=LANG['mediainsert'];btnp.appendChild(btn);addEvent(btn,'click',function(event){return media_manager.insert(event);});},insert:function(event){var id=media_manager.id;$('media__popup').style.display='none';var opts='';var optsstart='';var alignleft='';var alignright='';if(media_manager.ext=='img'||media_manager.ext=='swf'){if(media_manager.link=='4'){opts='?linkonly';}else{if(media_manager.link=="3"&&media_manager.ext=='img'){opts='?nolink';optsstart=true;}else if(media_manager.link=="2"&&media_manager.ext=='img'){opts='?direct';optsstart=true;}var s=parseInt(media_manager.size);if(s&&s>=1){opts+=(optsstart)?'&':'?';if(s=="1"){opts+='100';if(media_manager.ext=='swf'){opts+='x62';}}else if(s=="2"){opts+='200';if(media_manager.ext=='swf'){opts+='x123';}}else if(s=="3"){opts+='300';if(media_manager.ext=='swf'){opts+='x185';}}}if(media_manager.align=='1'){alignleft='';alignright=' ';}if(media_manager.align=='2'){alignleft=' ';alignright=' ';}if(media_manager.align=='3'){alignleft=' ';alignright='';}}}opener.insertTags('wiki__text','{{'+alignleft+id+opts+alignright+'|','}}','');if(!media_manager.keepopen)window.close();opener.focus();return false;},list:function(event,link){var ajax=new sack(DOKU_BASE+'lib/exe/ajax.php');ajax.AjaxFailedAlert='';ajax.encodeURIString=false;if(ajax.failed)return true;cleanMsgArea();var content=$('media__content');content.innerHTML='<img src="'+DOKU_BASE+'lib/images/loading.gif" alt="..." class="load" />';ajax.elementObj=content;ajax.afterCompletion=function(){media_manager.selectorattach(content);media_manager.confirmattach(content);media_manager.updatehide();media_manager.initFlashUpload();};ajax.runAJAX(link.search.substr(1)+'&call=medialist');return false;},toggle:function(event,clicky){var listitem=clicky.parentNode;var sublists=listitem.getElementsByTagName('ul');if(sublists.length){listitem.removeChild(sublists[0]);clicky.src=DOKU_BASE+'lib/images/plus.gif';return false;}var link=listitem.getElementsByTagName('a')[0];var ajax=new sack(DOKU_BASE+'lib/exe/ajax.php');ajax.AjaxFailedAlert='';ajax.encodeURIString=false;if(ajax.failed)return true;var ul=document.createElement('ul');listitem.appendChild(ul);ajax.elementObj=ul;ajax.afterCompletion=function(){media_manager.treeattach(ul);};ajax.runAJAX(link.search.substr(1)+'&call=medians');clicky.src=DOKU_BASE+'lib/images/minus.gif';return false;},suggest:function(){var file=$('upload__file');var name=$('upload__name');if(!file||!name)return;var text=file.value;text=text.substr(text.lastIndexOf('/')+1);text=text.substr(text.lastIndexOf('\\')+1);name.value=text;},initFlashUpload:function(){if(!hasFlash(8))return;var oform=$('dw__upload');var oflash=$('dw__flashupload');if(!oform||!oflash)return;var clicky=document.createElement('img');clicky.src=DOKU_BASE+'lib/images/multiupload.png';clicky.title=LANG['mu_btn'];clicky.alt=LANG['mu_btn'];clicky.style.cursor='pointer';clicky.onclick=function(){oform.style.display='none';oflash.style.display='';};oform.appendChild(clicky);},closePopup:function(event){$('media__popup').style.display='none';},setalign:function(event,cb){if(cb.value){DokuCookie.setValue('align',cb.value);media_manager.align=cb.value;media_manager.outSet("media__alignbtn0");media_manager.outSet("media__alignbtn1");media_manager.outSet("media__alignbtn2");media_manager.outSet("media__alignbtn3");media_manager.inSet("media__alignbtn"+cb.value);}else{DokuCookie.setValue('align','');media_manager.align=false;}},setlink:function(event,cb){if(cb.value){DokuCookie.setValue('link',cb.value);media_manager.link=cb.value;media_manager.outSet("media__linkbtn1");media_manager.outSet("media__linkbtn2");media_manager.outSet("media__linkbtn3");media_manager.outSet("media__linkbtn4");media_manager.inSet("media__linkbtn"+cb.value);var size=document.getElementById("media__size");var align=document.getElementById("media__align");if(cb.value!='4'){size.style.display="block";align.style.display="block";}else{size.style.display="none";align.style.display="none";}}else{DokuCookie.setValue('link','');media_manager.link=false;}},setdisplay:function(event,cb){if(cb.value){DokuCookie.setValue('display',cb.value);media_manager.display=cb.value;media_manager.outSet("media__displaybtn1");media_manager.outSet("media__displaybtn2");media_manager.inSet("media__displaybtn"+cb.value);}else{DokuCookie.setValue('display','');media_manager.align=false;}},outSet:function(id){var ele=document.getElementById(id);if(ele==null)return;ele.style.borderStyle="outset";},inSet:function(id){var ele=document.getElementById(id);if(ele==null)return;ele.style.borderStyle="inset";},setsize:function(event,cb){if(cb.value){DokuCookie.setValue('size',cb.value);media_manager.size=cb.value;for(var i=1;i<=4;++i){media_manager.outSet("media__sizebtn"+i);}media_manager.inSet("media__sizebtn"+cb.value);}else{DokuCookie.setValue('size','');media_manager.width=false;}}};addInitEvent(function(){media_manager.treeattach($('media__tree'));media_manager.selectorattach($('media__content'));media_manager.confirmattach($('media__content'));media_manager.attachoptions($('media__opts'));media_manager.initpopup();media_manager.initFlashUpload();});addInitEvent(function(){var form=$('subscribe__form');if(!form){return;}var styleradios={};function update_state(){if(!this.checked){return;}if(this.value.match(/:$/)){styleradios.list.parentNode.style.display='';}else{styleradios.list.parentNode.style.display='none';if(styleradios.list.checked){styleradios.digest.checked='checked';}}}var cur_sel=null;var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;++i){switch(inputs[i].name){case'sub_target':addEvent(inputs[i],'click',update_state);if(inputs[i].checked){cur_sel=inputs[i];}break;case'sub_style':styleradios[inputs[i].value]=inputs[i];break;}}update_state.call(cur_sel);});function plugin_tagindex_class(){this.pages=null;this.page=null;this.sack=null;this.done=1;this.count=0;}var pl_si=new plugin_tagindex_class();pl_si.sack=new sack(DOKU_BASE+'lib/plugins/tag/ajax.php');pl_si.sack.AjaxFailedAlert='';pl_si.sack.encodeURIString=false;function plugin_tagindex_throbber(on){obj=document.getElementById('pl_si_throbber');if(on){obj.style.visibility='visible';}else{obj.style.visibility='hidden';}}function plugin_tagindex_status(text){obj=document.getElementById('pl_si_out');obj.innerHTML=text;}function plugin_tagindex_cb_clear(){ok=this.response;if(ok==1){window.setTimeout("plugin_tagindex_index()",1000);}else{plugin_tagindex_status(ok);window.setTimeout("plugin_tagindex_clear()",5000);}}function plugin_tagindex_cb_pages(){data=this.response;pl_si.pages=data.split("\n");pl_si.count=pl_si.pages.length;plugin_tagindex_status(pl_si.pages.length+" pages found");pl_si.page=pl_si.pages.shift();window.setTimeout("plugin_tagindex_clear()",1000);}function plugin_tagindex_cb_index(){ok=this.response;if(ok==1){pl_si.page=pl_si.pages.shift();pl_si.done++;window.setTimeout("plugin_tagindex_index()",1000);}else{plugin_tagindex_status(ok);window.setTimeout("plugin_tagindex_index()",5000);}}function plugin_tagindex_index(){if(pl_si.page){plugin_tagindex_status('indexing<br />'+pl_si.page+'<br />('+pl_si.done+'/'+pl_si.count+')<br />');pl_si.sack.onCompletion=plugin_tagindex_cb_index;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=indexpage&page='+encodeURI(pl_si.page));}else{plugin_tagindex_status('finished');plugin_tagindex_throbber(false);}}function plugin_tagindex_clear(){plugin_tagindex_status('clearing index...');pl_si.sack.onCompletion=plugin_tagindex_cb_clear;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=clearindex');}function plugin_tagindex_go(){document.getElementById('pl_si_gobtn').style.display='none';plugin_tagindex_throbber(true);plugin_tagindex_status('Finding all pages');pl_si.sack.onCompletion=plugin_tagindex_cb_pages;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=pagelist');}function plugin_searchindex_class(){this.pages=null;this.page=null;this.sack=null;this.done=1;this.count=0;}var pl_si=new plugin_searchindex_class();pl_si.sack=new sack(DOKU_BASE+'lib/plugins/searchindex/ajax.php');pl_si.sack.AjaxFailedAlert='';pl_si.sack.encodeURIString=false;function plugin_searchindex_throbber(on){obj=document.getElementById('pl_si_throbber');if(on){obj.style.visibility='visible';}else{obj.style.visibility='hidden';}}function plugin_searchindex_status(text){obj=document.getElementById('pl_si_out');obj.innerHTML=text;}function plugin_searchindex_cb_clear(){ok=this.response;if(ok==1){window.setTimeout("plugin_searchindex_index()",1000);}else{plugin_searchindex_status(ok);window.setTimeout("plugin_searchindex_clear()",5000);}}function plugin_searchindex_cb_pages(){data=this.response;pl_si.pages=data.split("\n");pl_si.count=pl_si.pages.length;plugin_searchindex_status(pl_si.pages.length+" pages found");pl_si.page=pl_si.pages.shift();window.setTimeout("plugin_searchindex_clear()",1000);}function plugin_searchindex_cb_index(){ok=this.response;if(ok==1){pl_si.page=pl_si.pages.shift();pl_si.done++;window.setTimeout("plugin_searchindex_index()",1000);}else{plugin_searchindex_status(ok);window.setTimeout("plugin_searchindex_index()",5000);}}function plugin_searchindex_index(){if(pl_si.page){plugin_searchindex_status('indexing '+pl_si.page+' ('+pl_si.done+'/'+pl_si.count+')');pl_si.sack.onCompletion=plugin_searchindex_cb_index;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=indexpage&page='+encodeURI(pl_si.page));}else{plugin_searchindex_status('finished');plugin_searchindex_throbber(false);}}function plugin_searchindex_clear(){plugin_searchindex_status('clearing index...');pl_si.sack.onCompletion=plugin_searchindex_cb_clear;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=clearindex');}function plugin_searchindex_go(){document.getElementById('pl_si_gobtn').style.display='none';plugin_searchindex_throbber(true);plugin_searchindex_status('Finding all pages');pl_si.sack.onCompletion=plugin_searchindex_cb_pages;pl_si.sack.URLString='';pl_si.sack.runAJAX('call=pagelist');}jQuery(function(){if(jQuery.browser.msie&&8>parseFloat(jQuery.browser.version)){function isParentNode(p,n){if(!p)return false;while(n){if(n==p)return true;n=n.parentNode;}return false;}var q_open=Array();var q_close=Array();var ssheet=document.styleSheets[0];for(var i=0;i<ssheet.rules.length;i++){var srule=ssheet.rules[i];if(srule.selectorText=='Q'){var quotes=srule.style.quotes.split(' ');for(var j=0;j<quotes.length;j+=2){var q=quotes[j];if(q.length<3)continue;var q1=q.substring(1,q.length-1);var q2=q1;if(j+1<quotes.length){q=quotes[j+1];if(q.length>=3){q2=q.substring(1,q.length-1);}}q_open.push(q1);q_close.push(q2);}}}if(q_open.length==0)q_open.push('');if(q_close.length==0)q_close.push('');var qstack=Array();var qprev=null;var qelems=document.getElementsByTagName('q');for(var i=0;i<qelems.length;i++){var q=qelems[i];if(isParentNode(qprev,q)){if(qprev)qstack.push(qprev);}else{while(qstack.length>0){qprev=qstack.pop();if(isParentNode(qprev,q)){qstack.push(qprev);break;}}}var mark_before=document.createTextNode(q_open[qstack.length%q_open.length]);var mark_after=document.createTextNode(q_close[qstack.length%q_open.length]);q.insertBefore(mark_before,q.firstChild);q.insertBefore(mark_after);qprev=q;}var bqelems=document.getElementsByTagName('blockquote');for(var i=0;i<bqelems.length;i++){var bq=bqelems[i];var bq_cite=bq.getAttribute('title');if(bq.className=='citation'&&bq_cite){var bq_after=document.createElement('div');bq_after.setAttribute('className','citation_after');bq_after.innerHTML=''+bq_cite;bq.appendChild(bq_after);}}}});function usrmgr_delconfirm(){if($('usrmgr__del')){addEvent($('usrmgr__del'),'click',function(){return confirm(reallyDel);});}};addInitEvent(usrmgr_delconfirm);function indexmenu_createThemes(data,indx_list){var adata=data.split(',');var check=adata.shift();if(check!='indexmenu'){indx_list.innerHTML="No themes";adata=[];}else{var url=adata.shift();url+=adata.shift();}for(var key in adata){var btn=document.createElement('button');btn.className='pickerbutton';var ico=document.createElement('img');ico.src=url+"/"+adata[key]+"/base."+indexmenu_findExt(adata[key]+"/");var title=adata[key];btn.title=title;btn.appendChild(ico);if(title=="default"){title="";}else{title="#"+title;}eval("btn.onclick = function(){insertTags('"+jsEscape('wiki__text')+"','"+jsEscape("{{indexmenu>")+"','"+jsEscape("|js"+title+"}}")+"','"+jsEscape('.#1')+"');this.parentNode.style.display='none';return false;}");if(title===""){indx_list.insertBefore(btn,indx_list.firstChild);}else{indx_list.appendChild(btn);}}}function indexmenu_createToolbar(){var indx_ico=document.createElement('img');indx_ico.src=DOKU_BASE+'lib/plugins/indexmenu/images/indexmenu_toolbar.png';var indx_btn=document.createElement('button');indx_btn.id='syntax_plugin_indexmenu';indx_btn.className='toolbutton';indx_btn.title='Insert Indexmenu tree';indx_btn.appendChild(indx_ico);return indx_btn;}function indexmenu_toolbar_additions(){var toolbar=$('tool__bar');if(!toolbar)return;var edbtn=$('edbtn__save');if(!edbtn)return;indexmenu_createPicker('picker_plugin_indexmenu');var indx_btn=indexmenu_createToolbar();eval("indx_btn.onclick = function(){indexmenu_ajax('req=local','picker_plugin_indexmenu',this,true);return false;}");toolbar.appendChild(indx_btn);}function indexmenu_ajax(get,picker,btn,notoc){var indx_list=$(picker);var show=false;if(!indx_list){indx_list=indexmenu_createPicker(picker);indx_list.className='dokuwiki indexmenu_toc';indx_list.innerHTML='<a href="javascript: indexmenu_showPicker(\''+picker+'\');"><img src="'+DOKU_BASE+'lib/plugins/indexmenu/images/close.gif" /></a>';tocobj=document.createElement('div');indx_list.appendChild(tocobj);}if(!notoc){show=true;indx_list=indx_list.childNodes[1];}indexmenu_showPicker(picker,btn,show);var ajax=new sack(DOKU_BASE+'lib/plugins/indexmenu/ajax.php');ajax.encodeURIString=false;ajax.onLoading=function(){indx_list.innerHTML='<div class="tocheader">Loading .....</div>';};ajax.onCompletion=function(){var data=this.response;indx_list.innerHTML="";if(notoc){if(data.substring(0,9)!='indexmenu'){indx_list.innerHTML="Retriving error";return;}indexmenu_createThemes(data,indx_list);}else{indx_list.innerHTML=data;}};ajax.runAJAX(encodeURI(get));}function indexmenu_createPicker(id){var indx_list=document.createElement('div');indx_list.className='picker';indx_list.id=id;indx_list.style.position='absolute';indx_list.style.display='none';var body=document.getElementsByTagName('body')[0];body.appendChild(indx_list);return indx_list;}function indexmenu_showPicker(pickerid,btn,show){var picker=$(pickerid);var x=0;var y=0;if(btn){x=findPosX(btn);y=findPosY(btn);}if(picker.style.display=='none'||show){picker.style.display='block';picker.style.left=(x+3)+'px';var offs=(btn.offsetHeight)?btn.offsetHeight:10;picker.style.top=(y+offs+3)+'px';}else{picker.style.display='none';}}addInitEvent(indexmenu_toolbar_additions);(function($){$.prettyPhoto={version:'3.1.4'};$.fn.prettyPhoto=function(pp_settings){pp_settings=jQuery.extend({hook:'rel',animation_speed:'fast',ajaxcallback:function(){},slideshow:5000,autoplay_slideshow:false,opacity:0.80,show_title:true,allow_resize:true,allow_expand:true,default_width:500,default_height:344,description_src:'title',counter_separator_label:'/',theme:'pp_default',horizontal_padding:20,hideflash:false,wmode:'opaque',autoplay:true,modal:false,deeplinking:true,overlay_gallery:true,overlay_gallery_max:30,keyboard_shortcuts:true,changepicturecallback:function(){},callback:function(){},ie6_fallback:true,markup:'<div class="pp_pic_holder"> \
						<div class="ppt">&nbsp;</div> \
						<div class="pp_top"> \
							<div class="pp_left"></div> \
							<div class="pp_middle"></div> \
							<div class="pp_right"></div> \
						</div> \
						<div class="pp_content_container"> \
							<div class="pp_left"> \
							<div class="pp_right"> \
								<div class="pp_content"> \
									<div class="pp_loaderIcon"></div> \
									<div class="pp_fade"> \
										<a href="#" class="pp_expand" title="Expand the image">Expand</a> \
										<div class="pp_hoverContainer"> \
											<a class="pp_next" href="#">next</a> \
											<a class="pp_previous" href="#">previous</a> \
										</div> \
										<div id="pp_full_res"></div> \
										<div class="pp_details"> \
											<div class="pp_nav"> \
												<a href="#" class="pp_arrow_previous">Previous</a> \
												<p class="currentTextHolder">0/0</p> \
												<a href="#" class="pp_arrow_next">Next</a> \
											</div> \
											<p class="pp_description"></p> \
											<div class="pp_social">{pp_social}</div> \
											<a class="pp_close" href="#">Close</a> \
										</div> \
									</div> \
								</div> \
							</div> \
							</div> \
						</div> \
						<div class="pp_bottom"> \
							<div class="pp_left"></div> \
							<div class="pp_middle"></div> \
							<div class="pp_right"></div> \
						</div> \
					</div> \
					<div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> \
								<a href="#" class="pp_arrow_previous">Previous</a> \
								<div> \
									<ul> \
										{gallery} \
									</ul> \
								</div> \
								<a href="#" class="pp_arrow_next">Next</a> \
							</div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"><param name="autoplay" value="{autoplay}"><param name="type" value="video/quicktime"><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:'',social_tools:false},pp_settings);var matchedObjects=this,percentBased=false,pp_dimensions,pp_open,pp_contentHeight,pp_contentWidth,pp_containerHeight,pp_containerWidth,windowHeight=$(window).height(),windowWidth=$(window).width(),pp_slideshow,doresize=true,scroll_pos=_get_scroll();$(window).unbind('resize.prettyphoto').bind('resize.prettyphoto',function(){_center_overlay();_resize_overlay();});if(pp_settings.keyboard_shortcuts){$(document).unbind('keydown.prettyphoto').bind('keydown.prettyphoto',function(e){if(typeof $pp_pic_holder!='undefined'){if($pp_pic_holder.is(':visible')){switch(e.keyCode){case 37:$.prettyPhoto.changePage('previous');e.preventDefault();break;case 39:$.prettyPhoto.changePage('next');e.preventDefault();break;case 27:if(!settings.modal)$.prettyPhoto.close();e.preventDefault();break;}}}});}$.prettyPhoto.initialize=function(){settings=pp_settings;if(settings.theme=='pp_default')settings.horizontal_padding=16;if(settings.ie6_fallback&&$.browser.msie&&parseInt($.browser.version,10)==6)settings.theme="light_square";theRel=$(this).attr(settings.hook);galleryRegExp=/\[(?:.*)\]/;isSet=(galleryRegExp.exec(theRel))?true:false;pp_images=(isSet)?jQuery.map(matchedObjects,function(n,i){if($(n).attr(settings.hook).indexOf(theRel)!=-1)return $(n).attr('href');}):$.makeArray($(this).attr('href'));pp_titles=(isSet)?jQuery.map(matchedObjects,function(n,i){if($(n).attr(settings.hook).indexOf(theRel)!=-1)return($(n).find('img').attr('alt'))?$(n).find('img').attr('alt'):"";}):$.makeArray($(this).find('img').attr('alt'));pp_descriptions=(isSet)?jQuery.map(matchedObjects,function(n,i){if($(n).attr(settings.hook).indexOf(theRel)!=-1)return($(n).find('img').attr(settings.description_src))?$(n).find('img').attr(settings.description_src):"";}):$.makeArray($(this).find('img').attr(settings.description_src));if(pp_images.length>settings.overlay_gallery_max)settings.overlay_gallery=false;set_position=jQuery.inArray($(this).attr('href'),pp_images);rel_index=(isSet)?set_position:$("a["+settings.hook+"^='"+theRel+"']").index($(this));_build_overlay(this);if(settings.allow_resize)$(window).bind('scroll.prettyphoto',function(){_center_overlay();});$.prettyPhoto.open();return false;};$.prettyPhoto.open=function(event){if(typeof settings=="undefined"){settings=pp_settings;if($.browser.msie&&$.browser.version==6)settings.theme="light_square";pp_images=$.makeArray(arguments[0]);pp_titles=(arguments[1])?$.makeArray(arguments[1]):$.makeArray("");pp_descriptions=(arguments[2])?$.makeArray(arguments[2]):$.makeArray("");isSet=(pp_images.length>1)?true:false;set_position=(arguments[3])?arguments[3]:0;_build_overlay(event.target);}if($.browser.msie&&$.browser.version==6)$('select').css('visibility','hidden');if(settings.hideflash)$('object,embed,iframe[src*=youtube],iframe[src*=vimeo]').css('visibility','hidden');_checkPosition($(pp_images).size());$('.pp_loaderIcon').show();if(settings.deeplinking)setHashtag();if(settings.social_tools){facebook_like_link=settings.social_tools.replace(/{location_href}/g,encodeURIComponent(location.href));$pp_pic_holder.find('.pp_social').html(facebook_like_link);}if($ppt.is(':hidden'))$ppt.css('opacity',0).show();$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity);$pp_pic_holder.find('.currentTextHolder').text((set_position+1)+settings.counter_separator_label+$(pp_images).size());if(typeof pp_descriptions[set_position]!='undefined'&&pp_descriptions[set_position]!=""){$pp_pic_holder.find('.pp_description').show().html(unescape(pp_descriptions[set_position]));}else{$pp_pic_holder.find('.pp_description').hide();}movie_width=(parseFloat(getParam('width',pp_images[set_position])))?getParam('width',pp_images[set_position]):settings.default_width.toString();movie_height=(parseFloat(getParam('height',pp_images[set_position])))?getParam('height',pp_images[set_position]):settings.default_height.toString();percentBased=false;if(movie_height.indexOf('%')!=-1){movie_height=parseFloat(($(window).height()*parseFloat(movie_height)/100)-150);percentBased=true;}if(movie_width.indexOf('%')!=-1){movie_width=parseFloat(($(window).width()*parseFloat(movie_width)/100)-150);percentBased=true;}$pp_pic_holder.fadeIn(function(){(settings.show_title&&pp_titles[set_position]!=""&&typeof pp_titles[set_position]!="undefined")?$ppt.html(unescape(pp_titles[set_position])):$ppt.html('&nbsp;');imgPreloader="";skipInjection=false;switch(_getFileType(pp_images[set_position])){case'image':imgPreloader=new Image();nextImage=new Image();if(isSet&&set_position<$(pp_images).size()-1)nextImage.src=pp_images[set_position+1];prevImage=new Image();if(isSet&&pp_images[set_position-1])prevImage.src=pp_images[set_position-1];$pp_pic_holder.find('#pp_full_res')[0].innerHTML=settings.image_markup.replace(/\{path\}/g,pp_images[set_position]);imgPreloader.onload=function(){pp_dimensions=_fitToViewport(imgPreloader.width,imgPreloader.height);_showContent();};imgPreloader.onerror=function(){alert('Image cannot be loaded. Make sure the path is correct and image exist.');$.prettyPhoto.close();};imgPreloader.src=pp_images[set_position];break;case'youtube':pp_dimensions=_fitToViewport(movie_width,movie_height);movie_id=getParam('v',pp_images[set_position]);if(movie_id==""){movie_id=pp_images[set_position].split('youtu.be/');movie_id=movie_id[1];if(movie_id.indexOf('?')>0)movie_id=movie_id.substr(0,movie_id.indexOf('?'));if(movie_id.indexOf('&')>0)movie_id=movie_id.substr(0,movie_id.indexOf('&'));}movie='http://www.youtube.com/embed/'+movie_id;(getParam('rel',pp_images[set_position]))?movie+="?rel="+getParam('rel',pp_images[set_position]):movie+="?rel=1";if(settings.autoplay)movie+="&autoplay=1";toInject=settings.iframe_markup.replace(/\{width\}/g,pp_dimensions['width']).replace(/\{height\}/g,pp_dimensions['height']).replace(/\{wmode\}/g,settings.wmode).replace(/\{path\}/g,movie);break;case'vimeo':pp_dimensions=_fitToViewport(movie_width,movie_height);movie_id=pp_images[set_position];var regExp=/http:\/\/(www\.)?vimeo.com\/(\d+)/;var match=movie_id.match(regExp);movie='http://player.vimeo.com/video/'+match[2]+'?title=0&amp;byline=0&amp;portrait=0';if(settings.autoplay)movie+="&autoplay=1;";vimeo_width=pp_dimensions['width']+'/embed/?moog_width='+pp_dimensions['width'];toInject=settings.iframe_markup.replace(/\{width\}/g,vimeo_width).replace(/\{height\}/g,pp_dimensions['height']).replace(/\{path\}/g,movie);break;case'quicktime':pp_dimensions=_fitToViewport(movie_width,movie_height);pp_dimensions['height']+=15;pp_dimensions['contentHeight']+=15;pp_dimensions['containerHeight']+=15;toInject=settings.quicktime_markup.replace(/\{width\}/g,pp_dimensions['width']).replace(/\{height\}/g,pp_dimensions['height']).replace(/\{wmode\}/g,settings.wmode).replace(/\{path\}/g,pp_images[set_position]).replace(/\{autoplay\}/g,settings.autoplay);break;case'flash':pp_dimensions=_fitToViewport(movie_width,movie_height);flash_vars=pp_images[set_position];flash_vars=flash_vars.substring(pp_images[set_position].indexOf('flashvars')+10,pp_images[set_position].length);filename=pp_images[set_position];filename=filename.substring(0,filename.indexOf('?'));toInject=settings.flash_markup.replace(/\{width\}/g,pp_dimensions['width']).replace(/\{height\}/g,pp_dimensions['height']).replace(/\{wmode\}/g,settings.wmode).replace(/\{path\}/g,filename+'?'+flash_vars);break;case'iframe':pp_dimensions=_fitToViewport(movie_width,movie_height);frame_url=pp_images[set_position];frame_url=frame_url.substr(0,frame_url.indexOf('iframe')-1);toInject=settings.iframe_markup.replace(/\{width\}/g,pp_dimensions['width']).replace(/\{height\}/g,pp_dimensions['height']).replace(/\{path\}/g,frame_url);break;case'ajax':doresize=false;pp_dimensions=_fitToViewport(movie_width,movie_height);doresize=true;skipInjection=true;$.get(pp_images[set_position],function(responseHTML){toInject=settings.inline_markup.replace(/\{content\}/g,responseHTML);$pp_pic_holder.find('#pp_full_res')[0].innerHTML=toInject;_showContent();});break;case'custom':pp_dimensions=_fitToViewport(movie_width,movie_height);toInject=settings.custom_markup;break;case'inline':myClone=$(pp_images[set_position]).clone().append('<br clear="all" />').css({'width':settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo($('body')).show();doresize=false;pp_dimensions=_fitToViewport($(myClone).width(),$(myClone).height());doresize=true;$(myClone).remove();toInject=settings.inline_markup.replace(/\{content\}/g,$(pp_images[set_position]).html());break;}if(!imgPreloader&&!skipInjection){$pp_pic_holder.find('#pp_full_res')[0].innerHTML=toInject;_showContent();}});return false;};$.prettyPhoto.changePage=function(direction){currentGalleryPage=0;if(direction=='previous'){set_position--;if(set_position<0)set_position=$(pp_images).size()-1;}else if(direction=='next'){set_position++;if(set_position>$(pp_images).size()-1)set_position=0;}else{set_position=direction;}rel_index=set_position;if(!doresize)doresize=true;if(settings.allow_expand){$('.pp_contract').removeClass('pp_contract').addClass('pp_expand');}_hideContent(function(){$.prettyPhoto.open();});};$.prettyPhoto.changeGalleryPage=function(direction){if(direction=='next'){currentGalleryPage++;if(currentGalleryPage>totalPage)currentGalleryPage=0;}else if(direction=='previous'){currentGalleryPage--;if(currentGalleryPage<0)currentGalleryPage=totalPage;}else{currentGalleryPage=direction;}slide_speed=(direction=='next'||direction=='previous')?settings.animation_speed:0;slide_to=currentGalleryPage*(itemsPerPage*itemWidth);$pp_gallery.find('ul').animate({left:-slide_to},slide_speed);};$.prettyPhoto.startSlideshow=function(){if(typeof pp_slideshow=='undefined'){$pp_pic_holder.find('.pp_play').unbind('click').removeClass('pp_play').addClass('pp_pause').click(function(){$.prettyPhoto.stopSlideshow();return false;});pp_slideshow=setInterval($.prettyPhoto.startSlideshow,settings.slideshow);}else{$.prettyPhoto.changePage('next');}};$.prettyPhoto.stopSlideshow=function(){$pp_pic_holder.find('.pp_pause').unbind('click').removeClass('pp_pause').addClass('pp_play').click(function(){$.prettyPhoto.startSlideshow();return false;});clearInterval(pp_slideshow);pp_slideshow=undefined;};$.prettyPhoto.close=function(){if($pp_overlay.is(":animated"))return;$.prettyPhoto.stopSlideshow();$pp_pic_holder.stop().find('object,embed').css('visibility','hidden');$('div.pp_pic_holder,div.ppt,.pp_fade').fadeOut(settings.animation_speed,function(){$(this).remove();});$pp_overlay.fadeOut(settings.animation_speed,function(){if($.browser.msie&&$.browser.version==6)$('select').css('visibility','visible');if(settings.hideflash)$('object,embed,iframe[src*=youtube],iframe[src*=vimeo]').css('visibility','visible');$(this).remove();$(window).unbind('scroll.prettyphoto');clearHashtag();settings.callback();doresize=true;pp_open=false;delete settings;});};function _showContent(){$('.pp_loaderIcon').hide();projectedTop=scroll_pos['scrollTop']+((windowHeight/2)-(pp_dimensions['containerHeight']/2));if(projectedTop<0)projectedTop=0;$ppt.fadeTo(settings.animation_speed,1);$pp_pic_holder.find('.pp_content').animate({height:pp_dimensions['contentHeight'],width:pp_dimensions['contentWidth']},settings.animation_speed);$pp_pic_holder.animate({'top':projectedTop,'left':((windowWidth/2)-(pp_dimensions['containerWidth']/2)<0)?0:(windowWidth/2)-(pp_dimensions['containerWidth']/2),width:pp_dimensions['containerWidth']},settings.animation_speed,function(){$pp_pic_holder.find('.pp_hoverContainer,#fullResImage').height(pp_dimensions['height']).width(pp_dimensions['width']);$pp_pic_holder.find('.pp_fade').fadeIn(settings.animation_speed);if(isSet&&_getFileType(pp_images[set_position])=="image"){$pp_pic_holder.find('.pp_hoverContainer').show();}else{$pp_pic_holder.find('.pp_hoverContainer').hide();}if(settings.allow_expand){if(pp_dimensions['resized']){$('a.pp_expand,a.pp_contract').show();}else{$('a.pp_expand').hide();}}if(settings.autoplay_slideshow&&!pp_slideshow&&!pp_open)$.prettyPhoto.startSlideshow();settings.changepicturecallback();pp_open=true;});_insert_gallery();pp_settings.ajaxcallback();}function _hideContent(callback){$pp_pic_holder.find('#pp_full_res object,#pp_full_res embed').css('visibility','hidden');$pp_pic_holder.find('.pp_fade').fadeOut(settings.animation_speed,function(){$('.pp_loaderIcon').show();callback();});}function _checkPosition(setCount){(setCount>1)?$('.pp_nav').show():$('.pp_nav').hide();}function _fitToViewport(width,height){resized=false;_getDimensions(width,height);imageWidth=width,imageHeight=height;if(((pp_containerWidth>windowWidth)||(pp_containerHeight>windowHeight))&&doresize&&settings.allow_resize&&!percentBased){resized=true,fitting=false;while(!fitting){if((pp_containerWidth>windowWidth)){imageWidth=(windowWidth-200);imageHeight=(height/width)*imageWidth;}else if((pp_containerHeight>windowHeight)){imageHeight=(windowHeight-200);imageWidth=(width/height)*imageHeight;}else{fitting=true;}pp_containerHeight=imageHeight,pp_containerWidth=imageWidth;}if((pp_containerWidth>windowWidth)||(pp_containerHeight>windowHeight)){_fitToViewport(pp_containerWidth,pp_containerHeight)};_getDimensions(imageWidth,imageHeight);};return{width:Math.floor(imageWidth),height:Math.floor(imageHeight),containerHeight:Math.floor(pp_containerHeight),containerWidth:Math.floor(pp_containerWidth)+(settings.horizontal_padding*2),contentHeight:Math.floor(pp_contentHeight),contentWidth:Math.floor(pp_contentWidth),resized:resized};}function _getDimensions(width,height){width=parseFloat(width);height=parseFloat(height);$pp_details=$pp_pic_holder.find('.pp_details');$pp_details.width(width);detailsHeight=parseFloat($pp_details.css('marginTop'))+parseFloat($pp_details.css('marginBottom'));$pp_details=$pp_details.clone().addClass(settings.theme).width(width).appendTo($('body')).css({'position':'absolute','top':-10000});detailsHeight+=$pp_details.height();detailsHeight=(detailsHeight<=34)?36:detailsHeight;if($.browser.msie&&$.browser.version==7)detailsHeight+=8;$pp_details.remove();$pp_title=$pp_pic_holder.find('.ppt');$pp_title.width(width);titleHeight=parseFloat($pp_title.css('marginTop'))+parseFloat($pp_title.css('marginBottom'));$pp_title=$pp_title.clone().appendTo($('body')).css({'position':'absolute','top':-10000});titleHeight+=$pp_title.height();$pp_title.remove();pp_contentHeight=height+detailsHeight;pp_contentWidth=width;pp_containerHeight=pp_contentHeight+titleHeight+$pp_pic_holder.find('.pp_top').height()+$pp_pic_holder.find('.pp_bottom').height();pp_containerWidth=width;}function _getFileType(itemSrc){if(itemSrc.match(/youtube\.com\/watch/i)||itemSrc.match(/youtu\.be/i)){return'youtube';}else if(itemSrc.match(/vimeo\.com/i)){return'vimeo';}else if(itemSrc.match(/\b.mov\b/i)){return'quicktime';}else if(itemSrc.match(/\b.swf\b/i)){return'flash';}else if(itemSrc.match(/\biframe=true\b/i)){return'iframe';}else if(itemSrc.match(/\bajax=true\b/i)){return'ajax';}else if(itemSrc.match(/\bcustom=true\b/i)){return'custom';}else if(itemSrc.substr(0,1)=='#'){return'inline';}else{return'image';}}function _center_overlay(){if(doresize&&typeof $pp_pic_holder!='undefined'){scroll_pos=_get_scroll();contentHeight=$pp_pic_holder.height(),contentwidth=$pp_pic_holder.width();projectedTop=(windowHeight/2)+scroll_pos['scrollTop']-(contentHeight/2);if(projectedTop<0)projectedTop=0;if(contentHeight>windowHeight)return;$pp_pic_holder.css({'top':projectedTop,'left':(windowWidth/2)+scroll_pos['scrollLeft']-(contentwidth/2)});}}function _get_scroll(){if(self.pageYOffset){return{scrollTop:self.pageYOffset,scrollLeft:self.pageXOffset};}else if(document.documentElement&&document.documentElement.scrollTop){return{scrollTop:document.documentElement.scrollTop,scrollLeft:document.documentElement.scrollLeft};}else if(document.body){return{scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft};}}function _resize_overlay(){windowHeight=$(window).height(),windowWidth=$(window).width();if(typeof $pp_overlay!="undefined")$pp_overlay.height($(document).height()).width(windowWidth);}function _insert_gallery(){if(isSet&&settings.overlay_gallery&&_getFileType(pp_images[set_position])=="image"&&(settings.ie6_fallback&&!($.browser.msie&&parseInt($.browser.version,10)==6))){itemWidth=52+5;navWidth=(settings.theme=="facebook"||settings.theme=="pp_default")?50:30;itemsPerPage=Math.floor((pp_dimensions['containerWidth']-100-navWidth)/itemWidth);itemsPerPage=(itemsPerPage<pp_images.length)?itemsPerPage:pp_images.length;totalPage=Math.ceil(pp_images.length/itemsPerPage)-1;if(totalPage==0){navWidth=0;$pp_gallery.find('.pp_arrow_next,.pp_arrow_previous').hide();}else{$pp_gallery.find('.pp_arrow_next,.pp_arrow_previous').show();}galleryWidth=itemsPerPage*itemWidth;fullGalleryWidth=pp_images.length*itemWidth;$pp_gallery .css('margin-left',-((galleryWidth/2)+(navWidth/2))).find('div:first').width(galleryWidth+5).find('ul').width(fullGalleryWidth).find('li.selected').removeClass('selected');goToPage=(Math.floor(set_position/itemsPerPage)<totalPage)?Math.floor(set_position/itemsPerPage):totalPage;$.prettyPhoto.changeGalleryPage(goToPage);$pp_gallery_li.filter(':eq('+set_position+')').addClass('selected');}else{$pp_pic_holder.find('.pp_content').unbind('mouseenter mouseleave');}}function _build_overlay(caller){if(settings.social_tools)facebook_like_link=settings.social_tools.replace(/{location_href}/g,encodeURIComponent(location.href));settings.markup=settings.markup.replace('{pp_social}','');$('body').append(settings.markup);$pp_pic_holder=$('.pp_pic_holder'),$ppt=$('.ppt'),$pp_overlay=$('div.pp_overlay');if(isSet&&settings.overlay_gallery){currentGalleryPage=0;toInject="";for(var i=0;i<pp_images.length;i++){if(!pp_images[i].match(/\b(jpg|jpeg|png|gif)\b/gi)){classname='default';img_src='';}else{classname='';img_src=pp_images[i];}toInject+="<li class='"+classname+"'><a href='#'><img src='"+img_src+"' width='50' alt='' /></a></li>";}toInject=settings.gallery_markup.replace(/\{gallery\}/g,toInject);$pp_pic_holder.find('#pp_full_res').after(toInject);$pp_gallery=$('.pp_pic_holder .pp_gallery'),$pp_gallery_li=$pp_gallery.find('li');$pp_gallery.find('.pp_arrow_next').click(function(){$.prettyPhoto.changeGalleryPage('next');$.prettyPhoto.stopSlideshow();return false;});$pp_gallery.find('.pp_arrow_previous').click(function(){$.prettyPhoto.changeGalleryPage('previous');$.prettyPhoto.stopSlideshow();return false;});$pp_pic_holder.find('.pp_content').hover(function(){$pp_pic_holder.find('.pp_gallery:not(.disabled)').fadeIn();},function(){$pp_pic_holder.find('.pp_gallery:not(.disabled)').fadeOut();});itemWidth=52+5;$pp_gallery_li.each(function(i){$(this).find('a').click(function(){$.prettyPhoto.changePage(i);$.prettyPhoto.stopSlideshow();return false;});});}if(settings.slideshow){$pp_pic_holder.find('.pp_nav').prepend('<a href="#" class="pp_play">Play</a>');$pp_pic_holder.find('.pp_nav .pp_play').click(function(){$.prettyPhoto.startSlideshow();return false;});}$pp_pic_holder.attr('class','pp_pic_holder '+settings.theme);$pp_overlay .css({'opacity':0,'height':$(document).height(),'width':$(window).width()}).bind('click',function(){if(!settings.modal)$.prettyPhoto.close();});$('a.pp_close').bind('click',function(){$.prettyPhoto.close();return false;});if(settings.allow_expand){$('a.pp_expand').bind('click',function(e){if($(this).hasClass('pp_expand')){$(this).removeClass('pp_expand').addClass('pp_contract');doresize=false;}else{$(this).removeClass('pp_contract').addClass('pp_expand');doresize=true;}_hideContent(function(){$.prettyPhoto.open();});return false;});}$pp_pic_holder.find('.pp_previous, .pp_nav .pp_arrow_previous').bind('click',function(){$.prettyPhoto.changePage('previous');$.prettyPhoto.stopSlideshow();return false;});$pp_pic_holder.find('.pp_next, .pp_nav .pp_arrow_next').bind('click',function(){$.prettyPhoto.changePage('next');$.prettyPhoto.stopSlideshow();return false;});_center_overlay();}if(!pp_alreadyInitialized&&getHashtag()){pp_alreadyInitialized=true;hashIndex=getHashtag();hashRel=hashIndex;hashIndex=hashIndex.substring(hashIndex.indexOf('/')+1,hashIndex.length-1);hashRel=hashRel.substring(0,hashRel.indexOf('/'));setTimeout(function(){$("a["+pp_settings.hook+"^='"+hashRel+"']:eq("+hashIndex+")").trigger('click');},50);}return this.unbind('click.prettyphoto').bind('click.prettyphoto',$.prettyPhoto.initialize);};function getHashtag(){var url=location.href;hashtag=(url.indexOf('#prettyPhoto')!==-1)?decodeURI(url.substring(url.indexOf('#prettyPhoto')+1,url.length)):false;return hashtag;}function setHashtag(){if(typeof theRel=='undefined')return;location.hash=theRel+'/'+rel_index+'/';}function clearHashtag(){if(location.href.indexOf('#prettyPhoto')!==-1)location.hash="prettyPhoto";}function getParam(name,url){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(url);return(results==null)?"":results[1];}})(jQuery);var pp_alreadyInitialized=false;function gallery_plugin(){var $opts=jQuery('#media__opts');if(!$opts.length)return;if(!window.opener)return;var glbl=document.createElement('label');var glnk=document.createElement('a');var gbrk=document.createElement('br');glnk.name='gallery_plugin';glnk.innerHTML=LANG.plugins.gallery.addgal;glnk.style.cursor='pointer';glnk.onclick=function(){var $h1=jQuery('#media__ns');if(!$h1.length)return;var ns=$h1[0].innerHTML;opener.insertAtCarret('wiki__text','{{gallery>'+ns+'}}');if(!dw_mediamanager.keepopen)window.close();};$opts[0].appendChild(glbl);glbl.appendChild(glnk);$opts[0].appendChild(gbrk);}function gallery_pageselect(e){var galid=e.target.hash.substr(10,4);var $pages=jQuery('div.gallery__'+galid);$pages.hide();jQuery('#'+e.target.hash.substr(1)).show();return false;}jQuery(function(){jQuery("a.lightbox, a[rel^='lightbox']").prettyPhoto({overlay_gallery:false,slideshow:2000,description_src:'longdesc'});gallery_plugin();var $pages=jQuery('div.gallery_page');$pages.hide();$pages.eq(0).show();jQuery('a.gallery_pgsel').click(gallery_pageselect);});acl={init:function(){this.ctl=$('acl_manager');if(!this.ctl)return;var sel=$('acl__user').getElementsByTagName('select')[0];addEvent(sel,'change',acl.userselhandler);addEvent($('acl__tree'),'click',acl.treehandler);addEvent($('acl__user').getElementsByTagName('input')[1],'click',acl.loadinfo);},userselhandler:function(e){if(this.value=='__g__'||this.value=='__u__'){$('acl__user').getElementsByTagName('input')[0].style.display='';$('acl__user').getElementsByTagName('input')[1].style.display='';}else{$('acl__user').getElementsByTagName('input')[0].style.display='none';$('acl__user').getElementsByTagName('input')[1].style.display='none';}acl.loadinfo();},loadinfo:function(){var frm=$('acl__detail').getElementsByTagName('form')[0];var ajax=new sack(DOKU_BASE+'lib/plugins/acl/ajax.php');ajax.AjaxFailedAlert='';ajax.encodeURIString=false;if(ajax.failed)return true;var data=Array();data[0]=ajax.encVar('ns',frm.elements['ns'].value);data[1]=ajax.encVar('id',frm.elements['id'].value);data[2]=ajax.encVar('acl_t',frm.elements['acl_t'].value);data[3]=ajax.encVar('acl_w',frm.elements['acl_w'].value);data[4]=ajax.encVar('sectok',frm.elements['sectok'].value);data[5]=ajax.encVar('ajax','info');ajax.elementObj=$('acl__info');ajax.runAJAX(data.join('&'));return false;},parseatt:function(str){if(str[0]=='?')str=str.substr(1);var attributes={};var all=str.split('&');for(var i=0;i<all.length;i++){var att=all[i].split('=');attributes[att[0]]=decodeURIComponent(att[1]);}return attributes;},hsc:function(str){str=str.replace(/&/g,"&amp;");str=str.replace(/\"/g,"&quot;");str=str.replace(/\'/g,"&#039;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");return str;},treetoggle:function(clicky){var listitem=clicky.parentNode.parentNode;var sublists=listitem.getElementsByTagName('ul');if(sublists.length){listitem.removeChild(sublists[0]);clicky.src=DOKU_BASE+'lib/images/plus.gif';clicky.alt='+';return false;}var link=listitem.getElementsByTagName('a')[0];var ajax=new sack(DOKU_BASE+'lib/plugins/acl/ajax.php');ajax.AjaxFailedAlert='';ajax.encodeURIString=false;if(ajax.failed)return true;var ul=document.createElement('ul');listitem.appendChild(ul);ajax.elementObj=ul;ajax.setVar('ajax','tree');var frm=$('acl__detail').getElementsByTagName('form')[0];ajax.setVar('current_ns',encodeURIComponent(frm.elements['ns'].value));ajax.setVar('current_id',encodeURIComponent(frm.elements['id'].value));ajax.runAJAX(link.search.substr(1));clicky.src=DOKU_BASE+'lib/images/minus.gif';return false;},treehandler:function(e){if(e.target.src){acl.treetoggle(e.target);}else if(e.target.href){var obj=getElementsByClass('cur',$('acl__tree'),'a');for(var i=0;i<obj.length;i++){obj[i].className=obj[i].className.replace(/ cur/,'');}e.target.className+=' cur';var frm=$('acl__detail').getElementsByTagName('form')[0];if(e.target.className.search(/wikilink1/)>-1){frm.elements['ns'].value='';frm.elements['id'].value=acl.hsc(acl.parseatt(e.target.search)['id']);}else if(e.target.className.search(/idx_dir/)>-1){frm.elements['ns'].value=acl.hsc(acl.parseatt(e.target.search)['ns']);frm.elements['id'].value='';}acl.loadinfo();}e.stopPropagation();e.preventDefault();return false;}};addInitEvent(acl.init);addInitEvent(function(){addEvent(document,'click',closePopups);});addInitEvent(function(){addTocToggle();});addInitEvent(function(){initSizeCtl('size__ctl','wiki__text');});addInitEvent(function(){initToolbar('tool__bar','wiki__text',toolbar);});addInitEvent(function(){locktimer.init(840,'Votre blocage pour modifier cette page expire dans une minute.\nPour viter les conflits, utiliser le bouton Aperu pour rinitialiser le minuteur.',1);});addInitEvent(function(){scrollToMarker();});addInitEvent(function(){focusMarker();});
